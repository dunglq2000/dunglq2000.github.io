<!doctype html>
<html class="no-js" lang="vi" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Tìm Kiếm" href="../search.html" /><link rel="next" title="Dice CTF 2023" href="diceCTF.html" /><link rel="prev" title="Backdoor CTF 2023" href="backdoorCTF.html" />

    <!-- Generated with Sphinx 8.2.3 and Furo 2024.08.06 -->
        <title>Google CTF 2023 - Math Book</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="../_static/exercise.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="../_static/mystyles.css?v=fd3ba0dd" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">Math Book</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/Euler_Stamp.jpg" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">Math Book</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Tìm Kiếm" name="q" aria-label="Tìm Kiếm">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../introduction/index.html">Những lời nói đầu</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Những lời nói đầu</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../introduction/about-maths.html">Toán học là gì với mình?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/about-notebook.html">Cơ sở xây dựng notebook</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/about-quotations.html">Những lời răn</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/about-notation.html">Kí hiệu và công thức toán trong mật mã</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../algebra/index.html">Đại số</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Đại số</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../algebra/set/index.html">1. Đại cương về tập hợp</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of 1. Đại cương về tập hợp</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../algebra/set/set.html">1.1. Tập hợp</a></li>
<li class="toctree-l3"><a class="reference internal" href="../algebra/set/cadinality.html">1.2. Lực lượng của tập hợp</a></li>
<li class="toctree-l3"><a class="reference internal" href="../algebra/set/map.html">1.3. Ánh xạ</a></li>
<li class="toctree-l3"><a class="reference internal" href="../algebra/set/function.html">1.4. Hàm số</a></li>
<li class="toctree-l3"><a class="reference internal" href="../algebra/set/infinity.html">1.5. Các nghịch lý về tập vô hạn</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../algebra/polynomial/index.html">2. Đa thức</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of 2. Đa thức</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../algebra/polynomial/polynomial.html">2.1. Giới thiệu về đa thức</a></li>
<li class="toctree-l3"><a class="reference internal" href="../algebra/polynomial/polynomial.html#so-sanh-cong-tru-va-nhan-hai-da-thuc-mot-bien">2.2. So sánh, cộng, trừ và nhân hai đa thức một biến</a></li>
<li class="toctree-l3"><a class="reference internal" href="../algebra/polynomial/polynomial.html#phep-chia-da-thuc-mot-bien">2.3. Phép chia đa thức một biến</a></li>
<li class="toctree-l3"><a class="reference internal" href="../algebra/polynomial/polynomial.html#phep-chia-da-thuc-nhieu-bien">2.4. Phép chia đa thức nhiều biến</a></li>
<li class="toctree-l3"><a class="reference internal" href="../algebra/polynomial/lagrange-interpolation.html">2.5. Đa thức nội suy Lagrange</a></li>
<li class="toctree-l3"><a class="reference internal" href="../algebra/polynomial/numerical-methods.html">2.6. Phương pháp tính giá trị đa thức</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../algebra/proof.html">3. Phương pháp chứng minh toán học</a></li>
<li class="toctree-l2"><a class="reference internal" href="../algebra/glossary.html">4. Bảng thuật ngữ đại số</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../abstract-algebra/index.html">Lý thuyết nhóm</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Lý thuyết nhóm</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../abstract-algebra/groups/index.html">1. Lý thuyết nhóm</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of 1. Lý thuyết nhóm</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../abstract-algebra/groups/group.html">1.1. Nhóm</a></li>
<li class="toctree-l3"><a class="reference internal" href="../abstract-algebra/groups/symmetric-group.html">1.2. Nhóm hoán vị</a></li>
<li class="toctree-l3"><a class="reference internal" href="../abstract-algebra/groups/quasigroup.html">1.3. Quasigroup</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../abstract-algebra/homomorphisms/index.html">2. Homomorphisms</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of 2. Homomorphisms</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../abstract-algebra/homomorphisms/group-homomorphism.html">2.1. Group homomorphism</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../abstract-algebra/group-action/index.html">3. Tác động nhóm</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of 3. Tác động nhóm</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../abstract-algebra/group-action/group-action.html">3.1. Tác động nhóm</a></li>
<li class="toctree-l3"><a class="reference internal" href="../abstract-algebra/group-action/burnside.html">3.2. Bổ đề Burnside</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../abstract-algebra/rings/index.html">4. Vành</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of 4. Vành</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../abstract-algebra/rings/ring.html">4.1. Vành</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../abstract-algebra/fields/index.html">5. Trường</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of 5. Trường</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../abstract-algebra/fields/field.html">5.1. Trường</a></li>
<li class="toctree-l3"><a class="reference internal" href="../abstract-algebra/fields/ideal.html">5.2. Ideal</a></li>
<li class="toctree-l3"><a class="reference internal" href="../abstract-algebra/fields/ring-homomorphism.html">5.3. Ring kernel và ring homomorphism</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../abstract-algebra/galois-theory/index.html">6. Lý thuyết Galois</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle navigation of 6. Lý thuyết Galois</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../abstract-algebra/galois-theory/extension-field.html">6.1. Extension Fields</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../abstract-algebra/glossary.html">7. Bảng thuật ngữ lý thuyết nhóm</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../geometry/index.html">Hình học</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle navigation of Hình học</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../geometry/analytic-geometry/index.html">1. Hình học giải tích</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle navigation of 1. Hình học giải tích</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../geometry/analytic-geometry/intro.html">1.1. Theo dòng lịch sử</a></li>
<li class="toctree-l3"><a class="reference internal" href="../geometry/analytic-geometry/analytic-geometry.html">1.2. Phương pháp tọa độ trong mặt phẳng</a></li>
<li class="toctree-l3"><a class="reference internal" href="../geometry/analytic-geometry/analytic-geometry.html#dao-ham">1.3. Đạo hàm</a></li>
<li class="toctree-l3"><a class="reference internal" href="../geometry/analytic-geometry/analytic-geometry.html#tich-phan">1.4. Tích phân</a></li>
<li class="toctree-l3"><a class="reference internal" href="../geometry/analytic-geometry/conics.html">1.5. Ba đường Conic</a></li>
<li class="toctree-l3"><a class="reference internal" href="../geometry/analytic-geometry/transformation.html">1.6. Phép biến hình</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../geometry/brachistochrone/brachistochrone.html">2. Đường đoản thời</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../geometry/affine-geometry/index.html">3. Hình học affine</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle navigation of 3. Hình học affine</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../geometry/affine-geometry/affine-space.html">3.1. Không gian affine</a></li>
<li class="toctree-l3"><a class="reference internal" href="../geometry/affine-geometry/affine-space.html#phang">3.2. Phẳng</a></li>
<li class="toctree-l3"><a class="reference internal" href="../geometry/affine-geometry/affine-space.html#doc-lap-affine-va-phu-thuoc-affine">3.3. Độc lập affine và phụ thuộc affine</a></li>
<li class="toctree-l3"><a class="reference internal" href="../geometry/affine-geometry/affine-space.html#giao-cua-cac-phang-bao-affine">3.4. Giao của các phẳng. Bao affine</a></li>
<li class="toctree-l3"><a class="reference internal" href="../geometry/affine-geometry/affine-space.html#vi-tri-tuong-doi">3.5. Vị trí tương đối</a></li>
<li class="toctree-l3"><a class="reference internal" href="../geometry/affine-geometry/affine-space.html#muc-tieu-va-toa-do-affine">3.6. Mục tiêu và tọa độ affine</a></li>
<li class="toctree-l3"><a class="reference internal" href="../geometry/affine-geometry/affine-space.html#cong-thuc-doi-muc-tieu">3.7. Công thức đổi mục tiêu</a></li>
<li class="toctree-l3"><a class="reference internal" href="../geometry/affine-geometry/affine-space.html#phuong-trinh-cua-m-phang">3.8. Phương trình của <span class="math notranslate nohighlight">\(m\)</span>-phẳng</a></li>
<li class="toctree-l3"><a class="reference internal" href="../geometry/affine-geometry/affine-space.html#tam-ti-cu-va-ti-so-don">3.9. Tâm tỉ cự và tỉ số đơn</a></li>
<li class="toctree-l3"><a class="reference internal" href="../geometry/affine-geometry/affine-space.html#anh-xa-affine">3.10. Ánh xạ affine</a></li>
<li class="toctree-l3"><a class="reference internal" href="../geometry/affine-geometry/affine-space.html#su-xac-dinh-anh-xa-affine">3.11. Sự xác định ánh xạ affine</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../geometry/noneuclidean.html">4. Hình học phi Euclid</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../calculus/index.html">Giải tích</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle navigation of Giải tích</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../calculus/calculus/index.html">1. Giải tích</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><div class="visually-hidden">Toggle navigation of 1. Giải tích</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../calculus/calculus/limits.html">1.1. Giới hạn</a></li>
<li class="toctree-l3"><a class="reference internal" href="../calculus/calculus/continuity.html">1.2. Tính liên tục của hàm số</a></li>
<li class="toctree-l3"><a class="reference internal" href="../calculus/calculus/monotone.html">1.3. Tính đơn điệu và cực trị</a></li>
<li class="toctree-l3"><a class="reference internal" href="../calculus/calculus/derivative.html">1.4. Đạo hàm</a></li>
<li class="toctree-l3"><a class="reference internal" href="../calculus/calculus/partial-derivative.html">1.5. Đạo hàm một số hàm nhiều biến</a></li>
<li class="toctree-l3"><a class="reference internal" href="../calculus/calculus/avarage-value.html">1.6. Một số định lí về giá trị trung bình</a></li>
<li class="toctree-l3"><a class="reference internal" href="../calculus/calculus/concave.html">1.7. Tính lồi, lõm và điểm uốn của đồ thị</a></li>
<li class="toctree-l3"><a class="reference internal" href="../calculus/calculus/line-integral.html">1.8. Tích phân đường</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../calculus/differential-equation/index.html">2. Phương trình vi phân</a></li>
<li class="toctree-l2"><a class="reference internal" href="../calculus/series/index.html">3. Chuỗi số</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../probability/index.html">Xác suất thống kê</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><div class="visually-hidden">Toggle navigation of Xác suất thống kê</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../probability/intro.html">Xác suất thống kê</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../probability/ML/index.html">Machine Learning</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><div class="visually-hidden">Toggle navigation of Machine Learning</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../probability/ML/linear-regression.html">Linear Regression</a></li>
<li class="toctree-l3"><a class="reference internal" href="../probability/ML/kmeans.html">K-Means clustering</a></li>
<li class="toctree-l3"><a class="reference internal" href="../probability/ML/gradient-descent.html">Gradient Descent</a></li>
<li class="toctree-l3"><a class="reference internal" href="../probability/ML/perceptron.html">Perceptron Learning Algorithm</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../linalg/index.html">Đại số tuyến tính</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><div class="visually-hidden">Toggle navigation of Đại số tuyến tính</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../linalg/matrix/index.html">1. Ma trận</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><div class="visually-hidden">Toggle navigation of 1. Ma trận</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../linalg/matrix/matrix-determinant.html">1.1. Định thức ma trận</a></li>
<li class="toctree-l3"><a class="reference internal" href="../linalg/matrix/matrix-inversion.html">1.2. Ma trận nghịch đảo</a></li>
<li class="toctree-l3"><a class="reference internal" href="../linalg/matrix/matrix-rank.html">1.3. Hạng của ma trận</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../linalg/linear-operator.html">2. Toán tử tuyến tính</a></li>
<li class="toctree-l2"><a class="reference internal" href="../linalg/eigen.html">3. Trị riêng và vector riêng</a></li>
<li class="toctree-l2"><a class="reference internal" href="../linalg/linear-combination.html">4. Tổ hợp tuyến tính</a></li>
<li class="toctree-l2"><a class="reference internal" href="../linalg/vector-space.html">5. Không gian vector</a></li>
<li class="toctree-l2"><a class="reference internal" href="../linalg/euclidean-space.html">6. Không gian Euclide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../linalg/hilbert-space.html">7. Không gian Hilbert</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../number-theory/index.html">Lý thuyết số</a><input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" role="switch" type="checkbox"/><label for="toctree-checkbox-21"><div class="visually-hidden">Toggle navigation of Lý thuyết số</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../number-theory/euclidean.html">1. Phép chia Euclid. Thuật toán Euclid</a></li>
<li class="toctree-l2"><a class="reference internal" href="../number-theory/linear-congruence.html">2. Phương trình đồng dư tuyến tính</a></li>
<li class="toctree-l2"><a class="reference internal" href="../number-theory/arithmetic-functions.html">3. Các hàm số học quan trọng</a></li>
<li class="toctree-l2"><a class="reference internal" href="../number-theory/quadratic-residue.html">4. Thặng dư chính phương</a></li>
<li class="toctree-l2"><a class="reference internal" href="../number-theory/dirichlet-convolution.html">5. Tích chập Dirichlet</a></li>
<li class="toctree-l2"><a class="reference internal" href="../number-theory/chinese-remainder-theorem.html">6. Định lý số dư Trung Hoa</a></li>
<li class="toctree-l2"><a class="reference internal" href="../number-theory/exercises.html">7. Bài tập số học sưu tầm</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../discrete-mathematics/index.html">Toán rời rạc</a><input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" role="switch" type="checkbox"/><label for="toctree-checkbox-22"><div class="visually-hidden">Toggle navigation of Toán rời rạc</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../discrete-mathematics/binary-relation.html">Quan hệ hai ngôi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../discrete-mathematics/partition.html">Phân hoạch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../discrete-mathematics/discrete-fourier-transform.html">Biến đổi Fourier rời rạc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../discrete-mathematics/combinatoric.html">Đại cương tổ hợp</a></li>
<li class="toctree-l2"><a class="reference internal" href="../discrete-mathematics/recurrence-relation.html">Công thức truy hồi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../discrete-mathematics/system-lineq-integer.html">Hệ phương trình tuyến tính trên trường hữu hạn</a></li>
<li class="toctree-l2"><a class="reference internal" href="../discrete-mathematics/graph/index.html">Lý thuyết đồ thị</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../topology/index.html">Topology</a></li>
</ul>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../boolean/index.html">Đại số Bool và mật mã học</a><input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" role="switch" type="checkbox"/><label for="toctree-checkbox-23"><div class="visually-hidden">Toggle navigation of Đại số Bool và mật mã học</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../boolean/intro.html">1. Giới thiệu</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../boolean/boolean-algebra/index.html">2. Đại số Boolean</a><input class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" role="switch" type="checkbox"/><label for="toctree-checkbox-24"><div class="visually-hidden">Toggle navigation of 2. Đại số Boolean</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../boolean/boolean-algebra/boolean-function.html">2.1. Hàm boolean</a></li>
<li class="toctree-l3"><a class="reference internal" href="../boolean/boolean-algebra/boolean-affine.html">2.2. Hàm affine và hàm tuyến tính</a></li>
<li class="toctree-l3"><a class="reference internal" href="../boolean/boolean-algebra/boolean-monotone.html">2.3. Hàm đơn điệu</a></li>
<li class="toctree-l3"><a class="reference internal" href="../boolean/boolean-algebra/boolean-dnf-cnf.html">2.4. Disjunctive và Conjunctive Normal Form</a></li>
<li class="toctree-l3"><a class="reference internal" href="../boolean/boolean-algebra/boolean-weight.html">2.5. Khoảng cách Hamming</a></li>
<li class="toctree-l3"><a class="reference internal" href="../boolean/boolean-algebra/walsh-hadamard-spectre.html">2.6. Nonlinearity của hàm boolean</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../boolean/block/block-cipher.html">3. Block cipher</a><input class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" role="switch" type="checkbox"/><label for="toctree-checkbox-25"><div class="visually-hidden">Toggle navigation of 3. Block cipher</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../boolean/block/spnet.html">3.1. SP network</a></li>
<li class="toctree-l3"><a class="reference internal" href="../boolean/block/AES.html">3.2. AES</a></li>
<li class="toctree-l3"><a class="reference internal" href="../boolean/block/kuznyechik.html">3.3. Kuznyechik</a></li>
<li class="toctree-l3"><a class="reference internal" href="../boolean/block/present.html">3.4. PRESENT</a></li>
<li class="toctree-l3"><a class="reference internal" href="../boolean/block/feistel.html">3.5. Mô hình Feistel</a></li>
<li class="toctree-l3"><a class="reference internal" href="../boolean/block/magma.html">3.6. Magma</a></li>
<li class="toctree-l3"><a class="reference internal" href="../boolean/block/sms4.html">3.7. SMS4</a></li>
<li class="toctree-l3"><a class="reference internal" href="../boolean/block/arx.html">3.8. ARX</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../boolean/stream/stream-cipher.html">4. Stream cipher</a><input class="toctree-checkbox" id="toctree-checkbox-26" name="toctree-checkbox-26" role="switch" type="checkbox"/><label for="toctree-checkbox-26"><div class="visually-hidden">Toggle navigation of 4. Stream cipher</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../boolean/stream/linear-feedback-shift-register.html">4.1. Linear Feedback Shift Register</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../boolean/mac.html">5. Message Authentication Code</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../cryptanalysis/index.html">Phá mã</a><input class="toctree-checkbox" id="toctree-checkbox-27" name="toctree-checkbox-27" role="switch" type="checkbox"/><label for="toctree-checkbox-27"><div class="visually-hidden">Toggle navigation of Phá mã</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../cryptanalysis/differential-attack/index.html">1. Phá mã vi sai</a><input class="toctree-checkbox" id="toctree-checkbox-28" name="toctree-checkbox-28" role="switch" type="checkbox"/><label for="toctree-checkbox-28"><div class="visually-hidden">Toggle navigation of 1. Phá mã vi sai</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../cryptanalysis/differential-attack/toycipher.html">1.1. Nhập môn phá mã vi sai</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cryptanalysis/differential-attack/tinydes.html">1.2. Phá mã vi sai trên TinyDES</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cryptanalysis/differential-attack/difference-and-differential.html">1.3. Difference và differential</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../cryptanalysis/linear-attack/index.html">2. Phá mã tuyến tính</a><input class="toctree-checkbox" id="toctree-checkbox-29" name="toctree-checkbox-29" role="switch" type="checkbox"/><label for="toctree-checkbox-29"><div class="visually-hidden">Toggle navigation of 2. Phá mã tuyến tính</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../cryptanalysis/linear-attack/tinydes.html">2.1. Phá mã tuyến tính trên TinyDES</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../cryptanalysis/slide-attack/index.html">3. Slide attack</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cryptanalysis/algebraic-attack/index.html">4. Algebraic cryptanalysis</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../cryptography/index.html">Mật mã học</a><input class="toctree-checkbox" id="toctree-checkbox-30" name="toctree-checkbox-30" role="switch" type="checkbox"/><label for="toctree-checkbox-30"><div class="visually-hidden">Toggle navigation of Mật mã học</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../cryptography/lattice-based/index.html">1. Lattice-based cryptography</a><input class="toctree-checkbox" id="toctree-checkbox-31" name="toctree-checkbox-31" role="switch" type="checkbox"/><label for="toctree-checkbox-31"><div class="visually-hidden">Toggle navigation of 1. Lattice-based cryptography</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../cryptography/lattice-based/intro.html">1.1. Nhập môn mật mã dựa trên lattice</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cryptography/lattice-based/congruential-pubkey.html">1.2. Congruential public key cryptosystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cryptography/lattice-based/ntru.html">1.3. NTRU</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cryptography/lattice-based/falcon.html">1.4. FALCON</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cryptography/lattice-based/lattice-reduction-algorithms.html">1.5. Thuật toán rút gọn lattice</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cryptography/lattice-based/coppersmith.html">1.6. Phương pháp Coppersmith</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../cryptography/code-based/index.html">2. Code-based cryptography</a><input class="toctree-checkbox" id="toctree-checkbox-32" name="toctree-checkbox-32" role="switch" type="checkbox"/><label for="toctree-checkbox-32"><div class="visually-hidden">Toggle navigation of 2. Code-based cryptography</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../cryptography/code-based/intro.html">2.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cryptography/code-based/decode-problem.html">2.2. Bài toán decode tổng quát</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cryptography/code-based/linear-code.html">2.3. Linear code</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cryptography/code-based/weight.html">2.4. Bài toán phổ trọng số của mã tuyến tính</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cryptography/code-based/decode-on-linear-code.html">2.5. Bài toán decode trên linear code</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cryptography/code-based/equivalence.html">2.6. Bài toán tương đương các linear code</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cryptography/code-based/cryptosystem.html">2.7. Ý tưởng xây dựng các hệ mật mã dựa trên mã sửa sai</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cryptography/code-based/pubkey-algo.html">2.8. Các hệ mật mã khóa công khai dựa trên lý thuyết code</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cryptography/code-based/goppa-code.html">2.9. Goppa Code</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../cryptography/elliptic/index.html">3. Đường cong elliptic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cryptography/Kerckhoffs-principle/index.html">4. Nguyên tắc Kerckhoffs và mật mã học</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cryptography/examen.html">5. Câu hỏi ôn thi mật mã học</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cryptography/quantum-computing.html">6. Quantum computing</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../cryptography/zero-knowledge-proof/index.html">7. Zero Knowledge Proof</a><input class="toctree-checkbox" id="toctree-checkbox-33" name="toctree-checkbox-33" role="switch" type="checkbox"/><label for="toctree-checkbox-33"><div class="visually-hidden">Toggle navigation of 7. Zero Knowledge Proof</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../cryptography/zero-knowledge-proof/intro.html">7.1. Giới thiệu</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cryptography/zero-knowledge-proof/plonk.html">7.2. Plonk Protocol</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../solutions/index.html">Lời giải các bài tập trong sách tham khảo</a><input class="toctree-checkbox" id="toctree-checkbox-34" name="toctree-checkbox-34" role="switch" type="checkbox"/><label for="toctree-checkbox-34"><div class="visually-hidden">Toggle navigation of Lời giải các bài tập trong sách tham khảo</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../solutions/Judson.html">Abstract Algebra: Theory and Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../solutions/Petrushko/index.html">Курс высшей математики: Теория вероятностей</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../solutions/an-introduction-to-mathematical-cryptography/index.html">An Introduction to Mathematical Cryptography</a><input class="toctree-checkbox" id="toctree-checkbox-35" name="toctree-checkbox-35" role="switch" type="checkbox"/><label for="toctree-checkbox-35"><div class="visually-hidden">Toggle navigation of An Introduction to Mathematical Cryptography</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../solutions/an-introduction-to-mathematical-cryptography/chapter-2.html">Chapter 2. Discrete Logarithms and Diffie-Hellman</a></li>
<li class="toctree-l3"><a class="reference internal" href="../solutions/an-introduction-to-mathematical-cryptography/chapter-3.html">Chapter 3. Integer Factorization and RSA</a></li>
<li class="toctree-l3"><a class="reference internal" href="../solutions/an-introduction-to-mathematical-cryptography/chapter-4.html">Chapter 4. Digital Signatures</a></li>
<li class="toctree-l3"><a class="reference internal" href="../solutions/an-introduction-to-mathematical-cryptography/chapter-7.html">Chapter 7. Lattices and Cryptography</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../solutions/symmetric-cryptography/index.html">Симметричная криптография</a></li>
<li class="toctree-l2"><a class="reference internal" href="../solutions/collection.html">Các bài toán sưu tầm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../solutions/cryptohack/index.html">Wargame chill chill</a></li>
</ul>
</li>
</ul>
<ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="../2020/index.html">Các cuộc thi năm 2020</a><input class="toctree-checkbox" id="toctree-checkbox-36" name="toctree-checkbox-36" role="switch" type="checkbox"/><label for="toctree-checkbox-36"><div class="visually-hidden">Toggle navigation of Các cuộc thi năm 2020</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../2020/midnightsunCTF-2020.html">Midnight Sun CTF 2020</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2020/nsucrypto-2020.html">NSUCRYPTO 2020</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../2021/index.html">Các cuộc thi năm 2021</a><input class="toctree-checkbox" id="toctree-checkbox-37" name="toctree-checkbox-37" role="switch" type="checkbox"/><label for="toctree-checkbox-37"><div class="visually-hidden">Toggle navigation of Các cuộc thi năm 2021</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../2021/CryptoCTF/index.html">Crypto CTF 2021</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2021/GoogleCTF/index.html">Google CTF 2021</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2021/nsucrypto.html">NSUCRYPTO 2021</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../2022/index.html">Các cuộc thi năm 2022</a><input class="toctree-checkbox" id="toctree-checkbox-38" name="toctree-checkbox-38" role="switch" type="checkbox"/><label for="toctree-checkbox-38"><div class="visually-hidden">Toggle navigation of Các cuộc thi năm 2022</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../2022/downunderCTF/index.html">DownUnder CTF 2022</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2022/nsucrypto.html">NSUCRYPTO 2022</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2022/sekaiCTF/index.html">Sekai CTF 2022</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2022/isitdtu/index.html">ISITDTU Quals 2022</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Các cuộc thi năm 2023</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-39" name="toctree-checkbox-39" role="switch" type="checkbox"/><label for="toctree-checkbox-39"><div class="visually-hidden">Toggle navigation of Các cuộc thi năm 2023</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="nsucrypto/index.html">NSUCRYPTO 2023</a></li>
<li class="toctree-l2"><a class="reference internal" href="siberian-maths-contest/index.html">Siberian Mathematical Contest 2023</a></li>
<li class="toctree-l2"><a class="reference internal" href="amateursCTF.html">Amateurs CTF 2023</a></li>
<li class="toctree-l2"><a class="reference internal" href="backdoorCTF.html">Backdoor CTF 2023</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Google CTF 2023</a></li>
<li class="toctree-l2"><a class="reference internal" href="diceCTF.html">Dice CTF 2023</a></li>
<li class="toctree-l2"><a class="reference internal" href="UTCTF.html">UTCTF 2023</a></li>
<li class="toctree-l2"><a class="reference internal" href="wolvCTF.html">Wolv CTF 2023</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../2024/index.html">Các cuộc thi năm 2024</a><input class="toctree-checkbox" id="toctree-checkbox-40" name="toctree-checkbox-40" role="switch" type="checkbox"/><label for="toctree-checkbox-40"><div class="visually-hidden">Toggle navigation of Các cuộc thi năm 2024</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../2024/nsucrypto/index.html">NSUCRYPTO 2024</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2024/internet-olympiad/index.html">Internet Olympiad 2024</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2024/0xL4ughCTF-2024/index.html">0xL4ugh CTF 2024</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2024/ASISCTF-2024/index.html">ASIS CTF 2024</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2024/TJCTF.html">TJCTF 2024</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2024/cryptofox/index.html">CryptoFox 2024</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2024/isitdtu.html">ISITDTU Quals 2024</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../2025/index.html">Các cuộc thi năm 2025</a><input class="toctree-checkbox" id="toctree-checkbox-41" name="toctree-checkbox-41" role="switch" type="checkbox"/><label for="toctree-checkbox-41"><div class="visually-hidden">Toggle navigation of Các cuộc thi năm 2025</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../2025/cryptofox/index.html">CryptoFox 2025</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2025/tjctf.html">TJCTF 2025</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2025/yaprofi/index.html">Я - профессионал 2025</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../stuff/index.html">Ngoài lề</a><input class="toctree-checkbox" id="toctree-checkbox-42" name="toctree-checkbox-42" role="switch" type="checkbox"/><label for="toctree-checkbox-42"><div class="visually-hidden">Toggle navigation of Ngoài lề</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../stuff/game/index.html">Lý thuyết trò chơi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stuff/graphics.html">Một số đồ thị hàm số sưu tầm</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stuff/about-godel.html">Về một vị giáo sư và định lý Godel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stuff/about-stoicism.html">Chủ nghĩa khắc kỷ và phân phối nhị thức</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stuff/latex/index.html">Trải nghiệm người dùng với LaTeX</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../russia/index.html">Nước Nga du kí</a><input class="toctree-checkbox" id="toctree-checkbox-43" name="toctree-checkbox-43" role="switch" type="checkbox"/><label for="toctree-checkbox-43"><div class="visually-hidden">Toggle navigation of Nước Nga du kí</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../russia/intro.html">Giới thiệu</a></li>
<li class="toctree-l2"><a class="reference internal" href="../russia/good-or-bad.html">Đi học ở Nga tốt hay xấu?</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../russia/criticism/index.html">Góc khẩu nghiệp</a><input class="toctree-checkbox" id="toctree-checkbox-44" name="toctree-checkbox-44" role="switch" type="checkbox"/><label for="toctree-checkbox-44"><div class="visually-hidden">Toggle navigation of Góc khẩu nghiệp</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="simple">
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../russia/contests.html">Các cuộc thi toán ở Nga</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../mathematicians/index.html">Sưu tầm những câu chuyện về các nhà toán học</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../men-of-mathematics/index.html">Men of Mathematics</a><input class="toctree-checkbox" id="toctree-checkbox-45" name="toctree-checkbox-45" role="switch" type="checkbox"/><label for="toctree-checkbox-45"><div class="visually-hidden">Toggle navigation of Men of Mathematics</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../men-of-mathematics/dedicate.html">Lời nói đầu</a></li>
<li class="toctree-l2"><a class="reference internal" href="../men-of-mathematics/00-acknowledgement.html">Acknowledgments</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../game-programming/index.html">Lý thuyết lập trình game</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/2023/googleCTF.rst" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="google-ctf-2023">
<h1>Google CTF 2023<a class="headerlink" href="#google-ctf-2023" title="Link to this heading">¶</a></h1>
<section id="least-common-genominator">
<h2>LEAST COMMON GENOMINATOR?<a class="headerlink" href="#least-common-genominator" title="Link to this heading">¶</a></h2>
<p>Bài này sinh ra <span class="math notranslate nohighlight">\(8\)</span> số nguyên tố để mã hóa. Từ một trạng thái seed ban đầu <span class="math notranslate nohighlight">\(s\)</span>, số tiếp theo được sinh ra bởi số trước bởi công thức <span class="math notranslate nohighlight">\(s_{i+1} = (m s_i + c) \bmod{n}\)</span>.</p>
<p>Chúng ta chỉ biết seed ban đầu, không biết <span class="math notranslate nohighlight">\(m\)</span>, <span class="math notranslate nohighlight">\(c\)</span> hay <span class="math notranslate nohighlight">\(n\)</span>. Đề cho chúng ta dãy <span class="math notranslate nohighlight">\(6\)</span> số đầu tạo bởi chuỗi trên, giả sử là <span class="math notranslate nohighlight">\(s_0\)</span>, <span class="math notranslate nohighlight">\(s_1\)</span>, <span class="math notranslate nohighlight">\(s_2\)</span>, ...</p>
<p>Mình thấy rằng <span class="math notranslate nohighlight">\(s_1 = (m s_0 + c) \bmod n\)</span>, <span class="math notranslate nohighlight">\(s_2 = (m s_1 + c) \bmod n\)</span> và <span class="math notranslate nohighlight">\(s_3 = (m s_2 + c) \bmod n\)</span>.</p>
<p>Trừ vế theo vế mình có <span class="math notranslate nohighlight">\(s_2 - s_1 = m (s_1 - s_0) \bmod n\)</span> và <span class="math notranslate nohighlight">\(s_3 - s_2 = m (s_2 - s_1) \bmod n\)</span>.</p>
<p>Suy ra <span class="math notranslate nohighlight">\(n \mid (s_2 - s_1) - m (s_1 - s_0)\)</span> và <span class="math notranslate nohighlight">\(n \mid (s_3 - s_2) - m (s_2 - s_1)\)</span>. Như vậy nhân chéo lên để khử <span class="math notranslate nohighlight">\(m\)</span> mình thu được</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\begin{split}\begin{cases}
    n \mid (s_2 - s_1)^2 - m(s_1 - s_0) (s_2 - s_1) \\
    n \mid (s_3 - s_2) (s_1 - s_0) - m (s_2 - s_1) (s_1 - s_0)
\end{cases},\end{split}\]</div>
</div>
<p>hay tương đương với</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[n \mid (s_2 - s_1)^2 - (s_3 - s_2)(s_1 - s_0)\]</div>
</div>
<p>Tương tự như vậy với các cặp khác, dùng gcd mình sẽ tìm ra được <span class="math notranslate nohighlight">\(n\)</span>.</p>
<p>Khi đã có <span class="math notranslate nohighlight">\(n\)</span>, nhớ lại rằng <span class="math notranslate nohighlight">\(s_2 - s_1 = m (s_1 - s_0) \bmod n\)</span> sẽ suy ra được <span class="math notranslate nohighlight">\(m\)</span>. Cuối cùng do <span class="math notranslate nohighlight">\(s_1 = (m s_0 + c) \bmod n\)</span> nên sẽ tìm được <span class="math notranslate nohighlight">\(c\)</span>.</p>
<p>Có đủ <span class="math notranslate nohighlight">\(n\)</span>, <span class="math notranslate nohighlight">\(m\)</span> và <span class="math notranslate nohighlight">\(c\)</span> mình chạy hàm như đề bài là sẽ tìm được các số nguyên tố từ đó decrypt ra được kết quả.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">s0</span> <span class="o">=</span> <span class="mi">2166771675595184069339107365908377157701164485820981409993925279512199123418374034275465590004848135946671454084220731645099286746251308323653144363063385</span>
<span class="n">s1</span> <span class="o">=</span> <span class="mi">6729272950467625456298454678219613090467254824679318993052294587570153424935267364971827277137521929202783621553421958533761123653824135472378133765236115</span>
<span class="n">s2</span> <span class="o">=</span> <span class="mi">2230396903302352921484704122705539403201050490164649102182798059926343096511158288867301614648471516723052092761312105117735046752506523136197227936190287</span>
<span class="n">s3</span> <span class="o">=</span> <span class="mi">4578847787736143756850823407168519112175260092601476810539830792656568747136604250146858111418705054138266193348169239751046779010474924367072989895377792</span>
<span class="n">s4</span> <span class="o">=</span> <span class="mi">7578332979479086546637469036948482551151240099803812235949997147892871097982293017256475189504447955147399405791875395450814297264039908361472603256921612</span>
<span class="n">s5</span> <span class="o">=</span> <span class="mi">2550420443270381003007873520763042837493244197616666667768397146110589301602119884836605418664463550865399026934848289084292975494312467018767881691302197</span>
<span class="n">s_</span> <span class="o">=</span> <span class="mi">211286818345627549183608678726370412218029639873054513839005340650674982169404937862395980568550063504804783328450267566224937880641772833325018028629959635</span>

<span class="k">def</span><span class="w"> </span><span class="nf">gcd</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">while</span> <span class="n">b</span><span class="p">:</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">%</span> <span class="n">b</span>
    <span class="k">return</span> <span class="n">a</span>

<span class="n">u</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">s2</span> <span class="o">-</span> <span class="n">s1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">s1</span> <span class="o">-</span> <span class="n">s0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">s3</span> <span class="o">-</span> <span class="n">s2</span><span class="p">)</span>
<span class="n">v</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">s2</span> <span class="o">-</span> <span class="n">s1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">s3</span> <span class="o">-</span> <span class="n">s2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">s1</span> <span class="o">-</span> <span class="n">s0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">s4</span> <span class="o">-</span> <span class="n">s3</span><span class="p">)</span>
<span class="n">w</span> <span class="o">=</span> <span class="p">(</span><span class="n">s3</span> <span class="o">-</span> <span class="n">s2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">s2</span> <span class="o">-</span> <span class="n">s1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">s4</span> <span class="o">-</span> <span class="n">s3</span><span class="p">)</span>

<span class="n">n</span> <span class="o">=</span> <span class="n">gcd</span><span class="p">(</span><span class="n">gcd</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">),</span> <span class="n">w</span><span class="p">)</span> <span class="o">//</span> <span class="mi">7</span>
<span class="n">m</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">s1</span><span class="o">-</span><span class="n">s2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">s2</span><span class="o">-</span><span class="n">s3</span><span class="p">)</span> <span class="o">%</span> <span class="n">n</span>
<span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">s1</span> <span class="o">-</span> <span class="n">m</span><span class="o">*</span><span class="n">s0</span><span class="p">)</span> <span class="o">%</span> <span class="n">n</span>


<span class="k">class</span><span class="w"> </span><span class="nc">LCG</span><span class="p">:</span>
    <span class="n">lcg_m</span> <span class="o">=</span> <span class="n">m</span>
    <span class="n">lcg_c</span> <span class="o">=</span> <span class="n">c</span>
    <span class="n">lcg_n</span> <span class="o">=</span> <span class="n">n</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lcg_s</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">lcg_s</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lcg_m</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lcg_c</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">lcg_n</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span>

<span class="n">primes_arr</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">primes_n</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">lcg</span> <span class="o">=</span> <span class="n">LCG</span><span class="p">(</span><span class="n">s_</span><span class="p">)</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.Util.number</span><span class="w"> </span><span class="kn">import</span> <span class="n">isPrime</span><span class="p">,</span> <span class="n">bytes_to_long</span><span class="p">,</span> <span class="n">long_to_bytes</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">Crypto.PublicKey</span><span class="w"> </span><span class="kn">import</span> <span class="n">RSA</span>

<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">prime_candidate</span> <span class="o">=</span> <span class="n">lcg</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">isPrime</span><span class="p">(</span><span class="n">prime_candidate</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">prime_candidate</span><span class="o">.</span><span class="n">bit_length</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">512</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">primes_n</span> <span class="o">*=</span> <span class="n">prime_candidate</span>
                <span class="n">primes_arr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prime_candidate</span><span class="p">)</span>
                <span class="k">break</span>

    <span class="k">if</span> <span class="n">primes_n</span><span class="o">.</span><span class="n">bit_length</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">4096</span><span class="p">:</span>
        <span class="n">primes_arr</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">primes_n</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">continue</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">break</span>

<span class="nb">print</span><span class="p">(</span><span class="n">primes_arr</span><span class="p">)</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">primes_arr</span><span class="p">:</span>
    <span class="n">n</span> <span class="o">*=</span> <span class="n">j</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[+] Public Key: &quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[+] size: &quot;</span><span class="p">,</span> <span class="n">n</span><span class="o">.</span><span class="n">bit_length</span><span class="p">(),</span> <span class="s2">&quot;bits&quot;</span><span class="p">)</span>

<span class="c1"># Calculate totient &#39;Phi(n)&#39;</span>
<span class="n">phi</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">primes_arr</span><span class="p">:</span>
    <span class="n">phi</span> <span class="o">*=</span> <span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># Calculate private key &#39;d&#39;</span>
<span class="n">d</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">65537</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>
<span class="n">rsa</span> <span class="o">=</span> <span class="n">RSA</span><span class="o">.</span><span class="n">importKey</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;public.pem&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<span class="k">assert</span> <span class="n">rsa</span><span class="o">.</span><span class="n">n</span> <span class="o">==</span> <span class="n">n</span>
<span class="k">assert</span> <span class="n">rsa</span><span class="o">.</span><span class="n">e</span> <span class="o">==</span> <span class="mi">65537</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;flag.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="s2">&quot;little&quot;</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">long_to_bytes</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>

<span class="c1"># b&#39;CTF{C0nGr@tz_RiV35t_5h4MiR_nD_Ad13MaN_W0ulD_b_h@pPy}&#39;</span>
</pre></div>
</div>
</section>
<section id="cursved">
<h2>Cursved<a class="headerlink" href="#cursved" title="Link to this heading">¶</a></h2>
<p>Bài này định nghĩa một đường cong (có lẽ vậy) là tập hợp các điểm thỏa phương trình <span class="math notranslate nohighlight">\(x^2 = D y^2 + 1 \bmod p\)</span> với <span class="math notranslate nohighlight">\(D = 3\)</span> và <span class="math notranslate nohighlight">\(p\)</span> là số nguyên tố cho trước.</p>
<p>Phép cộng hai điểm <span class="math notranslate nohighlight">\((x_1, y_1)\)</span> và <span class="math notranslate nohighlight">\((x_2, y_2)\)</span> được định nghĩa là điểm <span class="math notranslate nohighlight">\((x_1 x_2 + D y_1 y_2, x_1 y_2 + x_2 y_1)\)</span> (tất cả trong modulo <span class="math notranslate nohighlight">\(p\)</span>).</p>
<p>Đề bài cho chúng ta biết điểm generator là <span class="math notranslate nohighlight">\(G = (2, 1)\)</span>, public key là một điểm không đổi trong tất cả lần chạy (điểm <span class="math notranslate nohighlight">\(P\)</span>). Mình gọi <span class="math notranslate nohighlight">\(k\)</span> là private key, là một số trong modulo <span class="math notranslate nohighlight">\(n = p-1\)</span> sao cho <span class="math notranslate nohighlight">\(P = k G\)</span>.</p>
<p>Hướng tấn công của bài này là xây dựng một homomorphism từ nhóm các điểm trên lên <span class="math notranslate nohighlight">\(\mathrm{GF}(p)\)</span> và giải discrete logarithm trên <span class="math notranslate nohighlight">\(\mathrm{GF}(p)\)</span>. Mình xét ánh xạ</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\varphi: \mathbb{F}_p \times \mathbb{F}_p \to \mathbb{F}_p, \quad (x, y) \to x + yW\]</div>
</div>
<p>Ở đây <span class="math notranslate nohighlight">\(W\)</span> là một số nào đó thuộc <span class="math notranslate nohighlight">\(\mathrm{GF}(p)\)</span>. Mình muốn ánh xạ này là homomorphism thì tương đương với điều kiện</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\varphi(x_1, y_1) \cdot \varphi(x_2, y_2) = \varphi(x_1 x_2 + D y_1 y_2, x_1 y_2 + x_2 y_1)\]</div>
</div>
<p>Tương đương với</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[(x_1 + y_1 W) \cdot (x_2 + y_2 W) = (x_1 x_2 + D y_1 y_2) + (x_1 y_2 + x_2 y_1) W\]</div>
</div>
<p>Khai triển và thu gọn mình có được <span class="math notranslate nohighlight">\(W^2 = D\)</span>. Như vậy <span class="math notranslate nohighlight">\(W = \sqrt{3} \bmod p\)</span>.</p>
<p>Và đúng là <span class="math notranslate nohighlight">\(D\)</span> là số chính phương modulo <span class="math notranslate nohighlight">\(p\)</span> thật, quá tốt :))))</p>
<p>Như vậy mình sẽ chuyển việc tính toán discrete logarithm <span class="math notranslate nohighlight">\(P = k G\)</span> trên tập hợp các điểm trên thành việc tính toán discrete logarithm ứng với phương trình</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[(x_G + y_G W)^k = (x_P + y_P W) \bmod p\]</div>
</div>
<p>Tới đây thì khá bế tắc vì <span class="math notranslate nohighlight">\(p-1\)</span> có các thừa số rất lớn. Mình đi &quot;hỏi thăm&quot; 1 vòng thì biết có tool open source rất mạnh để tính việc này là <a class="reference external" href="https://github.com/cado-nfs/cado-nfs">cado-nfs</a>.</p>
<p>Đặt <span class="math notranslate nohighlight">\(g = x_G + y_G W \bmod p\)</span> và <span class="math notranslate nohighlight">\(h = x_P + y_P W \bmod p\)</span>. Lúc giải mình thấy một điều lạ lùng là mình không dùng tool trên tính dlog modulo 2 được, nên mình chỉ tính dlog của <span class="math notranslate nohighlight">\(g\)</span> và <span class="math notranslate nohighlight">\(h\)</span> trên modulo <span class="math notranslate nohighlight">\((p-1)/2\)</span>. Cado-nfs sẽ trả về base, mình gọi là <span class="math notranslate nohighlight">\(b\)</span>, và dlog của <span class="math notranslate nohighlight">\(g\)</span> và <span class="math notranslate nohighlight">\(h\)</span> lần lượt là <span class="math notranslate nohighlight">\(t_1\)</span> và <span class="math notranslate nohighlight">\(t_2\)</span>.</p>
<p>Do <span class="math notranslate nohighlight">\(g = b^{t_1}\)</span>, <span class="math notranslate nohighlight">\(h = b^{t_2}\)</span>, <span class="math notranslate nohighlight">\(h = g^k\)</span> nên <span class="math notranslate nohighlight">\(b^{t_2} = b^{t_1 k}\)</span> (tất cả modulo <span class="math notranslate nohighlight">\(p\)</span>). Suy ra <span class="math notranslate nohighlight">\(t_2 = t_1 k \bmod \dfrac{p-1}{2}\)</span>, từ đó mình tìm được <span class="math notranslate nohighlight">\(k\)</span> và <span class="math notranslate nohighlight">\(k\)</span> này thỏa mãn <span class="math notranslate nohighlight">\(P = k G\)</span>.</p>
<p>Như vậy mình đã khôi phục lại private key và sẵn sàng ký bất cứ <cite>nonce</cite> nào gửi tới.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pwn</span><span class="w"> </span><span class="kn">import</span> <span class="n">remote</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">process</span>

<span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;Debug&#39;</span>

<span class="n">C</span> <span class="o">=</span> <span class="n">Curve</span><span class="p">(</span><span class="mh">0x34096DC6CE88B7D7CB09DE1FEC1EDF9B448D4BE9E341A9F6DC696EF4E4E213B3</span><span class="p">,</span>
        <span class="mh">0x3</span><span class="p">,</span>
        <span class="mh">0x34096DC6CE88B7D7CB09DE1FEC1EDF9B448D4BE9E341A9F6DC696EF4E4E213B2</span><span class="p">)</span>
<span class="n">G</span> <span class="o">=</span> <span class="n">C</span> <span class="o">@</span> <span class="p">(</span><span class="mh">0x2</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">)</span>
<span class="n">P</span> <span class="o">=</span> <span class="n">C</span> <span class="o">@</span> <span class="p">(</span><span class="mh">0x2FE4D1B7BA0F64D6E5BD5E4E8D55E898FF13B76974646D97BFDCD9DC688C0E2F</span><span class="p">,</span> <span class="mh">0x8C33E2FC2957EFF24DD1CD5382169C3BFAAC2E75A900D322A8C84D3C641A27E</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="mi">597042838662739992479017662198571932571177156379622917145185173378909836425</span>
<span class="nb">print</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">G</span> <span class="o">==</span> <span class="n">P</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">&quot;cursved.2023.ctfcompetition.com&quot;</span><span class="p">,</span> <span class="mi">1337</span><span class="p">)</span>
<span class="c1">#r = process([&quot;python3&quot;, &quot;chal.py&quot;])</span>
<span class="n">priv</span> <span class="o">=</span> <span class="n">Priv</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">G</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
<span class="n">pub</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
<span class="n">nonce</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">priv</span><span class="o">.</span><span class="n">get_pub</span><span class="p">()</span><span class="o">.</span><span class="n">P</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">nonce</span><span class="p">)</span>
<span class="n">sig</span> <span class="o">=</span> <span class="n">priv</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">nonce</span><span class="p">))</span>
<span class="n">Rx</span><span class="p">,</span> <span class="n">Ry</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sig</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">sig</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">sig</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">r</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;sig = &quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">Rx</span><span class="p">,</span> <span class="n">Ry</span><span class="p">,</span> <span class="n">s</span><span class="p">])</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
<span class="n">r</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
<span class="n">r</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># b&#39;CTF{pe11_conics_are_not_quite_e11iptic_curves}\n&#39;</span>
</pre></div>
</div>
</section>
<section id="mhk2">
<h2>MHK2<a class="headerlink" href="#mhk2" title="Link to this heading">¶</a></h2>
<section id="tao-private-key">
<h3>1. Tạo private key<a class="headerlink" href="#tao-private-key" title="Link to this heading">¶</a></h3>
<p>Để tạo private key, server random hai dãy số <span class="math notranslate nohighlight">\(s_1 = (s_{11}, s_{12}, \ldots, s_{1n})\)</span> và <span class="math notranslate nohighlight">\(s_2 = (s_{21}, s_{22}, \ldots, s_{2n})\)</span> với <span class="math notranslate nohighlight">\(n = 256\)</span> và <span class="math notranslate nohighlight">\(s_{ij}\)</span> <span class="math notranslate nohighlight">\(64\)</span> bit.</p>
<p>Hệ thống sinh dãy số cho tới khi <span class="math notranslate nohighlight">\(\displaystyle{p_1 = \sum_{i=1}^n s_{1i} + 2}\)</span> là số nguyên tố, tương tự cho <span class="math notranslate nohighlight">\(\displaystyle{p_2 = \sum_{i=1}^n s_{2i} + 2}\)</span> là số nguyên tố. Sau đó hệ thống chọn ngẫu nhiên số <span class="math notranslate nohighlight">\(e_1 \in \Bigl[\dfrac{p_1}{2}, p_1\Bigl]\)</span> và <span class="math notranslate nohighlight">\(e_2 \in \Bigl[\dfrac{p_2}{2}, p_2\Bigr]\)</span>.</p>
<p>Cuối cùng tính</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[s = (s_{11} + s_{21}, s_{12} + s_{22}, \ldots, s_{1n} + s_{2n}) = (s_1, s_2, \ldots, s_n).\]</div>
</div>
</section>
<section id="tao-public-key">
<h3>2. Tạo public key<a class="headerlink" href="#tao-public-key" title="Link to this heading">¶</a></h3>
<p>Từ hai dãy <span class="math notranslate nohighlight">\(s_1\)</span> và <span class="math notranslate nohighlight">\(s_2\)</span> ở trên hệ thống tính hai dãy <span class="math notranslate nohighlight">\(a_1 = (e_1 * s_{11}, e_1 * s_{12}, \ldots, e_1 * s_{1n})\)</span> (tất cả trong modulo <span class="math notranslate nohighlight">\(p_1\)</span>) và <span class="math notranslate nohighlight">\(a_2 = (e_2 * s_{21}, e_2 * s_{22}, \ldots, e_2 * s_{2n})\)</span> (tất cả trong modulo <span class="math notranslate nohighlight">\(p_2\)</span>).</p>
<p>Đặt</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[b_1 = (s_{11} \bmod 2, s_{12} \bmod 2, \ldots, s_{1n} \bmod 2).\]</div>
</div>
<p>Đặt</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[b_2 = (s_{21} \bmod 2, s_{22} \bmod 2, \ldots, s_{2n} \bmod 2).\]</div>
</div>
<p>Đặt</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[b = (s_1 \bmod 2, s_2 \bmod 2, \ldots, s_n \bmod 2).\]</div>
</div>
<p>Cuối cùng, <span class="math notranslate nohighlight">\(c\)</span> được chọn ngẫu nhiên, hoặc là <span class="math notranslate nohighlight">\(b_1\)</span>, hoặc là <span class="math notranslate nohighlight">\(b_2\)</span>.</p>
</section>
<section id="ma-hoa">
<h3>3. Mã hóa<a class="headerlink" href="#ma-hoa" title="Link to this heading">¶</a></h3>
<p>Để mã hóa một bit, <span class="math notranslate nohighlight">\(\mathrm{bit} \in \{0, 1\}\)</span>, đầu tiên tạo hai dãy ngẫu nhiên <span class="math notranslate nohighlight">\(r_1 = (r_{11}, r_{12}, \ldots, r_{1n})\)</span> và <span class="math notranslate nohighlight">\(r_2 = (r_{21}, r_{22}, \ldots, r_{2n})\)</span> với <span class="math notranslate nohighlight">\(r_{ij} \in \{0, 1\}\)</span>.</p>
<p>Khi đó ciphertext là <span class="math notranslate nohighlight">\(c_1 = \sum_{i=1}^n a_{1i} \cdot r_{1i}\)</span> và <span class="math notranslate nohighlight">\(c_2 \sum_{i=1}^n a_{2i} \cdot r_{2i}\)</span> (điều kiện đối với <span class="math notranslate nohighlight">\(\mathrm{bit}\)</span> ở <span class="math notranslate nohighlight">\(m_1\)</span>, <span class="math notranslate nohighlight">\(m_2\)</span> và <span class="math notranslate nohighlight">\(eq\)</span> nhưng hiện tại chúng ta không cần dùng tới).</p>
</section>
<section id="khoi-phuc-private-key">
<h3>4. Khôi phục private key<a class="headerlink" href="#khoi-phuc-private-key" title="Link to this heading">¶</a></h3>
<p>Chi tiết cách giải bài này mình tham khảo writeup của Google và Mystiz. Về mặt lý thuyết mình không hiểu sao họ có thể nghĩ ra lattice hay như vậy :)))) Do đó ở đây mình chỉ trình bày cách xây dựng lattice để giải bài này.</p>
<p>Ý tưởng là từ public key <span class="math notranslate nohighlight">\(a_1\)</span> (<span class="math notranslate nohighlight">\(a_2\)</span> tương tự) mình sẽ khôi phục lại <span class="math notranslate nohighlight">\(p_1\)</span> và <span class="math notranslate nohighlight">\(e_1\)</span>.</p>
<p>Đặt <span class="math notranslate nohighlight">\(A_1 = \sum_{i=1}^n a_{1i}\)</span>.</p>
<p>Do <span class="math notranslate nohighlight">\(a_{1i} = e_1 \cdot s_{1i} \bmod p_1\)</span> với <span class="math notranslate nohighlight">\(i = \overline{1, n}\)</span> nên <span class="math notranslate nohighlight">\(A_1 = \sum\limits_{i=1}^n e_1 \cdot s_{1i} = e_1 \sum\limits_{i=1}^N s_{1i}\)</span>. Mà mình đã biết <span class="math notranslate nohighlight">\(p_1 = \sum\limits_{i=1}^n s_{1i} + 2\)</span> nên phương trình trên tương đương với <span class="math notranslate nohighlight">\(A_1 = e_1 * (p_1 - 2)\)</span>. Lấy modulo <span class="math notranslate nohighlight">\(p_1\)</span> ta có <span class="math notranslate nohighlight">\(A_1 \equiv -2 e_1 \bmod p_1\)</span>.</p>
<p>Từ việc <span class="math notranslate nohighlight">\(a_{1i} \equiv e_1 \cdot s_{1i} \bmod p_1\)</span>, ta có <span class="math notranslate nohighlight">\(2 a_{1i} \equiv 2 e_1 \cdot s_{1i} \equiv -A_1 \cdot s_{1i} \bmod p_1\)</span>.</p>
<p>Nghĩa là tồn tại số <span class="math notranslate nohighlight">\(x_{1i} \in \mathbb{Z}\)</span> sao cho <span class="math notranslate nohighlight">\(2 a_{1i} + A_1 \cdot s_{1i} = x_{1i} \cdot p_1\)</span> với <span class="math notranslate nohighlight">\(i = \overline{1, n}\)</span>.</p>
<p>Mình có thể đánh giá <span class="math notranslate nohighlight">\(x_{1i}\)</span> đơn giản như sau:</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[x_{1i} = \dfrac{2 a_{1i} + A_1 s_{1i}}{p_1} \leqslant \dfrac{2 \max(a_{1i}) + A_1 \cdot 2^{128}}{\max(a_{1i})}\]</div>
</div>
<p>xấp xỉ 136 bit.</p>
<p>Lấy <span class="math notranslate nohighlight">\(i=1\)</span> ta có <span class="math notranslate nohighlight">\(2 a_{11} + A_1 \cdot s_{11} = x_{11} \cdot p_1\)</span> (1).</p>
<p>Lấy <span class="math notranslate nohighlight">\(2 \leqslant i \leqslant n\)</span> ta có <span class="math notranslate nohighlight">\(2 a_{1i} + A_1 \cdot s_{1i} = x_{1i} \cdot p_1\)</span> (2).</p>
<p>Để khử <span class="math notranslate nohighlight">\(p_1\)</span> mình nhân hai vế phương trình (1) cho <span class="math notranslate nohighlight">\(x_{1i}\)</span> và nhân hai vế phương trình (2) cho <span class="math notranslate nohighlight">\(x_{11}\)</span>, rồi trừ vế theo vế thu được</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[2 a_{11} \cdot x_{1i} - 2 a_{1i} \cdot x_{11} + A_1 (s_{11} \cdot x_{1i} - s_{1i} \cdot x_{11}) = 0.\]</div>
</div>
<p>Ở đây chúng ta đã biết <span class="math notranslate nohighlight">\(a_{11}\)</span>, <span class="math notranslate nohighlight">\(a_{1i}\)</span> và <span class="math notranslate nohighlight">\(A_1\)</span>. Việc xây dựng lattice sẽ dựa trên các hệ số <span class="math notranslate nohighlight">\(x_{1i}\)</span>, <span class="math notranslate nohighlight">\(x_{11}\)</span> và <span class="math notranslate nohighlight">\(s_{11} \cdot x_{1i} - s_{1i} * s_{11}\)</span>. Do đó mình viết</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{ccc}
    x_{11} &amp; \cdot &amp; (\ldots, -2a_{1i}, \ldots) \\
    x_{1i} &amp; \cdot &amp; (\ldots, 2a_{11}, \ldots) \\
    \ldots &amp; \cdot &amp; (\ldots, \ldots, \ldots) \\
    (s_{11} \cdot x_{1i} - s_{1i} * x_{11}) &amp; * &amp; (\ldots, A_1, \ldots) \\
    \ldots &amp; \cdot &amp; (\ldots, \ldots, \ldots)
\end{array}\end{split}\]</div>
</div>
<p>Với <span class="math notranslate nohighlight">\(i = \overline{2, n}\)</span> thì mình sẽ cần <span class="math notranslate nohighlight">\(255\)</span> cột. Tuy nhiên chúng ta thường sử dụng <span class="math notranslate nohighlight">\(1\)</span> để khi tính ra lattice thì sẽ thu được số cần tìm, cụ thể ở đây là <span class="math notranslate nohighlight">\(x_{11}\)</span> và <span class="math notranslate nohighlight">\(s_{11} \cdot x_{1i} - s_{1i} \cdot x_{11}\)</span>. Do đó mình sẽ modify nhẹ lại lattice trên thành</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}{ccc}
    x_{11} &amp; \cdot &amp; (1, \ldots, -2a_{1i}, \ldots) \\
    x_{1i} &amp; \cdot &amp; (\ldots, \ldots, 2a_{11}, \ldots) \\
    \ldots &amp; \cdot &amp; (\ldots, \ldots, \ldots, \ldots) \\
    (s_{11} \cdot x_{1i} - s_{1i} * x_{11}) &amp; * &amp; (0, 1, \ldots, A_1, \ldots) \\
    \ldots &amp; \cdot &amp; (\ldots, \ldots, \ldots, \ldots)
\end{array}\end{split}\]</div>
</div>
<p>Ở dòng <span class="math notranslate nohighlight">\(s_{11} \cdot x_{1i} - s_{1i} \cdot x_{11}\)</span> chúng ta không muốn nó đụng độ với số <span class="math notranslate nohighlight">\(x_{11}\)</span> bên trên nên sẽ dịch qua phải một ô. Ta cần <span class="math notranslate nohighlight">\(255\)</span> cột như vậy vì sẽ có <span class="math notranslate nohighlight">\(i=\overline{2, 256}\)</span>. Và để sắp xếp <span class="math notranslate nohighlight">\(-2 a_{1i}\)</span> cũng cần <span class="math notranslate nohighlight">\(255\)</span> cột như đã nói ở trên. Vậy lattice này có <span class="math notranslate nohighlight">\(1 + 255 + 255 = 511\)</span> cột và cũng là số hàng. Lattice như vậy sẽ có dạng ma trận như sau</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\begin{split}\begin{pmatrix}1 &amp; 0 &amp; 0 &amp; \ldots &amp; -2a_{12} &amp; -2a_{13} &amp; \ldots \\ 0 &amp; 0 &amp; 0 &amp; \ldots &amp; 2a_{11} &amp; 0 &amp; \ldots \\ 0 &amp; 0 &amp; 0 &amp; \ldots &amp; 0 &amp; 2a_{11} &amp; \ldots \\ \ldots &amp; \ldots &amp; \ldots &amp; \ldots &amp; \ldots &amp; \ldots &amp; \ldots \\ 0 &amp; 1 &amp; \ldots &amp; \ldots &amp; A_1 &amp; 0 &amp; \ldots \\ 0 &amp; 0 &amp; 1 &amp; \ldots &amp; 0 &amp; A_1 &amp; \ldots \\ \ldots &amp; \ldots &amp; \ldots &amp; \ldots &amp; \ldots &amp; \ldots &amp; \ldots \\ \end{pmatrix}\end{split}\]</div>
</div>
<p>Tới lúc này chúng ta đã hoàn thành ... 10% chặng đường. Lý do là vì với lattice này chúng ta không thể giải ra short vector mong muốn được. Dựa trên lattice mình hy vọng sẽ chạy ra vector</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[v = (x_{11}, s_{11} \cdot x_{12} - s_{12} \cdot x_{11}, \ldots, s_{11} \cdot x_{1n} - s_{1n} \cdot x_{11}, 0, 0, \ldots, 0)\]</div>
</div>
<p>Tuy nhiên cần nhớ rằng <span class="math notranslate nohighlight">\(s_{1i}\)</span> có <span class="math notranslate nohighlight">\(64\)</span> bit và <span class="math notranslate nohighlight">\(x_{1i}\)</span> xấp xỉ <span class="math notranslate nohighlight">\(136\)</span> bit. Bằng tính toán có thể thấy <span class="math notranslate nohighlight">\(s_{11} \cdot x_{1i} - s_{1i} \cdot x_{11}\)</span> cũng có <span class="math notranslate nohighlight">\(64\)</span> bit. Như vậy chúng ta cần scale lattice trên để các giá trị không sai khác nhau quá lớn.</p>
<p>Cụ thể, do <span class="math notranslate nohighlight">\(x_{11}\)</span> có <span class="math notranslate nohighlight">\(136\)</span> bit nên ta sẽ nhân với <span class="math notranslate nohighlight">\(\dfrac{1}{2^{136}}\)</span>, do <span class="math notranslate nohighlight">\(s_{11} \cdot x_{1i} - s_{1i} \cdot x_{11}\)</span> có <span class="math notranslate nohighlight">\(64\)</span> bit nên ta sẽ nhân với <span class="math notranslate nohighlight">\(\dfrac{1}{2^{128}}\)</span>. Đối với <span class="math notranslate nohighlight">\(-2a_{1i}\)</span>, <span class="math notranslate nohighlight">\(2a_{11}\)</span> và <span class="math notranslate nohighlight">\(A_1\)</span> thì mình cần chúng lớn để lattice tìm ra short vector, nên nhân với <span class="math notranslate nohighlight">\(2^{1024}\)</span>.</p>
<p>Sử dụng tính chất</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\begin{split}\begin{pmatrix} a_{11} &amp; a_{12} &amp; \ldots &amp; a_{1n} \\ a_{21} &amp; a_{22} &amp; \ldots &amp; a_{2n} \\ \ldots &amp; \ldots &amp; \ldots &amp; \ldots \\ a_{n1} &amp; a_{n2} &amp; \ldots &amp; a_{nn} \end{pmatrix} \times \begin{pmatrix} b_1 &amp; 0 &amp; 0 &amp; 0 \\ 0 &amp; b_2 &amp; 0 &amp; 0 \\ 0 &amp; 0 &amp; \ddots &amp; 0 \\ 0 &amp; 0 &amp; 0 &amp; b_n \end{pmatrix} = \begin{pmatrix} a_{11} b_1 &amp; a_{12} b_2 &amp; \ldots &amp; a_{1n} b_n \\ a_{21} b_1 &amp; a_{22} b_2 &amp; \ldots &amp; a_{2n} b_n \\ \ldots &amp; \ldots &amp; \ldots &amp; \ldots \\ a_{n1} b_1 &amp; a_{n2} b_2 &amp; \ldots &amp; a_{nn} b_n \end{pmatrix}\end{split}\]</div>
</div>
<p>Mình sẽ nhân lattice trên với ma trận sau là sẽ scale được hệ số theo nhu cầu</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\begin{split}\begin{pmatrix}\dfrac{1}{2^{136}} &amp; &amp; &amp; &amp; &amp; &amp; \\ &amp; \dfrac{1}{2^{128}} &amp; &amp; &amp; &amp; &amp; \\ &amp; &amp; \ddots &amp; \dfrac{1}{2^{128}} &amp; &amp; &amp; &amp; \\ &amp; &amp; &amp; &amp; 2^{1024} &amp; &amp; \\ &amp; &amp; &amp; &amp; &amp; \ddots &amp; \\ &amp; &amp; &amp; &amp; &amp; &amp; 2^{1024}\end{pmatrix}\end{split}\]</div>
</div>
<p>Phần tử đầu tiên của short vector là <span class="math notranslate nohighlight">\(x_{11}\)</span> (có lẽ vậy :v). Thật ra thì phần tử đầu tiên của short vector là <span class="math notranslate nohighlight">\(x_{11} \bmod a_{11}\)</span> hoặc <span class="math notranslate nohighlight">\(-x_{11} \bmod a_{11}\)</span>. Phía trên mình đã tính được chặn trên của <span class="math notranslate nohighlight">\(x_{11}\)</span> là <span class="math notranslate nohighlight">\(\dfrac{2 \max(a_{1i}) + A_1 \cdot 2^{128}}{\max(a_{1i})}\)</span>. Từ đây mình duyệt vòng for qua các giá trị <span class="math notranslate nohighlight">\(x_{11} + k a_{11}\)</span> và <span class="math notranslate nohighlight">\(-x_{11} + k a_{11}\)</span> để tìm các số <span class="math notranslate nohighlight">\(s_{1i}\)</span> theo cách sau</p>
<section id="a-khoi-phuc-modulo">
<h4>a. Khôi phục modulo<a class="headerlink" href="#a-khoi-phuc-modulo" title="Link to this heading">¶</a></h4>
<p>Nhắc lại <span class="math notranslate nohighlight">\(2 a_{11} + A_1 \cdot s_{11} = x_{11} \cdot p_1\)</span>. Modulo hai vế cho <span class="math notranslate nohighlight">\(A_1\)</span> thì được <span class="math notranslate nohighlight">\(2 a_{11} = x_{11} * p_1 \bmod A_1\)</span>. Ở đây có thể tìm được <span class="math notranslate nohighlight">\(p_1 = 2a_{11} x_{11}^{-1} \bmod A_1\)</span>. Tuy nhiên chúng ta cần lưu ý rằng điều kiện để tồn tại nghịch đảo là <span class="math notranslate nohighlight">\(\gcd(x_{11}, A_1) = 1\)</span>. Do đó để đảm bảo chúng ta tính toán thêm một bước.</p>
<p>Đặt <span class="math notranslate nohighlight">\(g = \gcd(2a_{11}, A_1)\)</span>. Khi đó phương trình đồng dư có nghiệm khi và chỉ khi <span class="math notranslate nohighlight">\(\gcd(x_{11} \cdot p_1, A_1)\)</span> chia hết cho <span class="math notranslate nohighlight">\(g\)</span>. Sau khi thỏa các điều kiện này, đặt <span class="math notranslate nohighlight">\(\dfrac{A_1}{g} = A_1'\)</span>, <span class="math notranslate nohighlight">\(2 a_{11}' = \dfrac{2a_{11}}{g} \bmod \dfrac{A_1}{g}\)</span>, và <span class="math notranslate nohighlight">\(x_{11}' = \dfrac{x_{11}}{g} \bmod \dfrac{A_1}{g}\)</span>. Khi đó <span class="math notranslate nohighlight">\(p_1 = 2a_{11}' \cdot x_{11}'^{-1} \bmod A_1'\)</span>.</p>
</section>
<section id="b-khoi-phuc-e">
<h4>b. Khôi phục e<a class="headerlink" href="#b-khoi-phuc-e" title="Link to this heading">¶</a></h4>
<p>Bên trên mình đã có <span class="math notranslate nohighlight">\(A_1 = -2e_1 \bmod p_1\)</span> nên mình sẽ tìm được <span class="math notranslate nohighlight">\(e_1\)</span>. Sau đó từ <span class="math notranslate nohighlight">\(a_1 = (a_{11}, a_{12}, \ldots, a_{1n})\)</span> và <span class="math notranslate nohighlight">\(e_1\)</span> mình tính lại được tất cả <span class="math notranslate nohighlight">\(s_{1i}\)</span> và kiểm tra xem <span class="math notranslate nohighlight">\(\sum\limits_{i=1}^n s_i + 2 \equiv p_1\)</span>, đồng thời không có số <span class="math notranslate nohighlight">\(s_{1i}\)</span> nào vượt quá <span class="math notranslate nohighlight">\(64\)</span> bit.</p>
</section>
<section id="c-giai">
<h4>c. Giải<a class="headerlink" href="#c-giai" title="Link to this heading">¶</a></h4>
<p>Đoạn code mình lấy của Google. Lưu ý rằng sau khi LLL xong mình cần scale ngược lại độ lớn ban đầu, ở đây là chia cho ma trận <span class="math notranslate nohighlight">\(Q\)</span>. Do một chút lười nên ở đây thay <cite>a2</cite> thành <cite>a_1</cite> để áp dụng cho <span class="math notranslate nohighlight">\(p_1\)</span>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">M</span> <span class="o">=</span> <span class="n">Matrix</span><span class="p">(</span><span class="n">QQ</span><span class="p">,</span> <span class="mi">511</span><span class="p">,</span> <span class="mi">511</span><span class="p">)</span>
<span class="n">sum_a</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">a2</span><span class="p">)</span>
<span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">255</span><span class="p">):</span>
    <span class="n">M</span><span class="p">[</span><span class="mi">256</span><span class="o">+</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">255</span><span class="p">):</span>
    <span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">256</span><span class="o">+</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">256</span><span class="o">+</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">M</span><span class="p">[</span><span class="mi">256</span><span class="o">+</span><span class="n">i</span><span class="p">,</span> <span class="mi">256</span><span class="o">+</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sum_a</span>

<span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="o">^</span><span class="mi">136</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="o">^</span><span class="mi">128</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">255</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[</span><span class="mi">2</span><span class="o">^</span><span class="mi">1024</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">255</span><span class="p">)]</span>
<span class="n">Q</span> <span class="o">=</span> <span class="n">diagonal_matrix</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>

<span class="n">M</span> <span class="o">*=</span> <span class="n">Q</span>
<span class="n">M</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">LLL</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Done LLL!&quot;</span><span class="p">)</span>
<span class="n">M</span> <span class="o">/=</span> <span class="n">Q</span>

<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">M</span><span class="p">:</span>
    <span class="n">x0_</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">256</span><span class="p">]</span>
    <span class="n">zeros</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">256</span><span class="p">:]</span>

    <span class="k">if</span> <span class="nb">list</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">255</span><span class="p">)]:</span> <span class="k">continue</span>
    <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">zeros</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span> <span class="k">continue</span>
    <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">zeros</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span> <span class="k">continue</span>

    <span class="n">x0_bound</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="n">a2</span><span class="p">)</span> <span class="o">+</span> <span class="n">sum_a</span> <span class="o">*</span> <span class="mi">2</span><span class="o">^</span><span class="mi">128</span><span class="p">)</span> <span class="o">//</span> <span class="nb">max</span><span class="p">(</span><span class="n">a2</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">x0</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">+</span><span class="n">x0_</span><span class="p">,</span> <span class="n">x0_bound</span><span class="p">,</span> <span class="o">+</span><span class="n">a2</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">x0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sum_a</span>
        <span class="c1">#print(u, v, m)</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">gcd</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">gcd</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span> <span class="o">%</span> <span class="n">g</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span> <span class="k">continue</span>
        <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">u</span> <span class="o">//</span> <span class="n">g</span><span class="p">,</span> <span class="n">v</span> <span class="o">//</span> <span class="n">g</span><span class="p">,</span> <span class="n">m</span> <span class="o">//</span> <span class="n">g</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Zmod</span><span class="p">(</span><span class="n">m</span><span class="p">)(</span><span class="n">v</span><span class="o">/</span><span class="n">u</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">p1</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_prime</span><span class="p">(</span><span class="n">p1</span><span class="p">):</span> <span class="k">continue</span>
            <span class="n">e</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Zmod</span><span class="p">(</span><span class="n">p1</span><span class="p">)(</span><span class="o">-</span><span class="n">sum_a</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">gcd</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">p1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span> <span class="k">continue</span>
            <span class="n">s</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">Zmod</span><span class="p">(</span><span class="n">p1</span><span class="p">)(</span><span class="n">a_</span><span class="o">/</span><span class="n">e</span><span class="p">))</span> <span class="k">for</span> <span class="n">a_</span> <span class="ow">in</span> <span class="n">a2</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">!=</span> <span class="n">p1</span><span class="p">:</span> <span class="k">continue</span>
            <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="o">^</span><span class="mi">128</span><span class="p">:</span> <span class="k">continue</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found! p = </span><span class="si">{</span><span class="n">p1</span><span class="si">}</span><span class="s2">, e = </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">for</span> <span class="n">x0</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">x0_</span><span class="p">,</span> <span class="n">x0_bound</span><span class="p">,</span> <span class="o">+</span><span class="n">a2</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">x0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">a2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sum_a</span>
        <span class="c1">#print(u, v, m)</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">gcd</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">gcd</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span> <span class="o">%</span> <span class="n">g</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span> <span class="k">continue</span>
        <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">u</span> <span class="o">//</span> <span class="n">g</span><span class="p">,</span> <span class="n">v</span> <span class="o">//</span> <span class="n">g</span><span class="p">,</span> <span class="n">m</span> <span class="o">//</span> <span class="n">g</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Zmod</span><span class="p">(</span><span class="n">m</span><span class="p">)(</span><span class="n">v</span><span class="o">/</span><span class="n">u</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">p1</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_prime</span><span class="p">(</span><span class="n">p1</span><span class="p">):</span> <span class="k">continue</span>
            <span class="n">e</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Zmod</span><span class="p">(</span><span class="n">p1</span><span class="p">)(</span><span class="o">-</span><span class="n">sum_a</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">e</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">gcd</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">p1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span> <span class="k">continue</span>
            <span class="n">s</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">Zmod</span><span class="p">(</span><span class="n">p1</span><span class="p">)(</span><span class="n">a_</span><span class="o">/</span><span class="n">e</span><span class="p">))</span> <span class="k">for</span> <span class="n">a_</span> <span class="ow">in</span> <span class="n">a2</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">!=</span> <span class="n">p1</span><span class="p">:</span> <span class="k">continue</span>
            <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="o">^</span><span class="mi">128</span><span class="p">:</span> <span class="k">continue</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found! p = </span><span class="si">{</span><span class="n">p1</span><span class="si">}</span><span class="s2">, e = </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
</pre></div>
</div>
<p>Cuối cùng chạy decrypt và lấy flag thôi.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># CTF{faNNYPAcKs_ARe_4maZiNg_AnD_und3Rr@t3d}</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="mytls">
<h2>MYTLS<a class="headerlink" href="#mytls" title="Link to this heading">¶</a></h2>
<p>Bài này dựa trên nguyên lý handshake của TLS (mãi sau mình đàm đạo với các bạn khác mới biết :v). Trong bài này đề cho các file sau:</p>
<ul class="simple">
<li><p>admin-ecdhcert.pem</p></li>
<li><p>ca-crt.pem</p></li>
<li><p>Dockerfile</p></li>
<li><p>guest-ecdhcert.pem</p></li>
<li><p>guest-ecdhkey.pem</p></li>
<li><p>server-ecdhcert.pem</p></li>
<li><p>server.py</p></li>
<li><p>start.sh</p></li>
</ul>
<p>Ở bài này xảy ra hai công đoạn trao đổi khóa, mình sẽ gọi là <cite>share_key</cite> và <cite>share_ephemeral_key</cite>.</p>
<p>Đối với <cite>share_ephemeral_key</cite>, mình sẽ cần gửi lên một chuỗi hex độ dài <span class="math notranslate nohighlight">\(32\)</span> ký tự, và một public key ECDH theo dạng PEM. Server cũng sẽ tạo một chuỗi hex độ dài <span class="math notranslate nohighlight">\(32\)</span> ký tự, private key và public key ECDH, sau đó gửi public key ECDH này về cho mình cũng ở dạng PEM.</p>
<p>Khi đó <cite>share_ephemeral_key</cite> sẽ được tính là</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">server_ephemeral_secret</span> <span class="o">=</span> <span class="n">client_ephemeral_private_key</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span>
    <span class="n">ec</span><span class="o">.</span><span class="n">ECDH</span><span class="p">(),</span> <span class="n">server_ephemeral_public_key</span><span class="p">)</span>
</pre></div>
</div>
<p>Điều này là tương đương với đoạn code sau của đề vì việc trao đổi khóa sẽ giống nhau ở hai bên trao đổi khóa.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">server_ephemeral_secret</span> <span class="o">=</span> <span class="n">server_ephemeral_key</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span>
    <span class="n">ec</span><span class="o">.</span><span class="n">ECDH</span><span class="p">(),</span> <span class="n">client_ephemeral_public_key</span><span class="p">)</span>
</pre></div>
</div>
<p>Do đó mình chỉ cần tạo một ECDH key mỗi lần trao đổi khóa, hoặc tạo một lần cũng được.</p>
<p>Tiếp theo là <code class="docutils literal notranslate"><span class="pre">share_key</span></code>.</p>
<p>Ở đầu bài, mình sẽ cần cung cấp một public key (certificate) cho server. Server sẽ sử dụng ca-crt.pem để verify xem cert của mình có hợp lệ không (có được ký bởi CA không). Server cũng sẽ đọc private key tương ứng (ở file <cite>server-ecdhkey.pem</cite>) và tiến hành trao đổi khóa ECDH lần hai.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">server_secret</span> <span class="o">=</span> <span class="n">server_key</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="n">ec</span><span class="o">.</span><span class="n">ECDH</span><span class="p">(),</span> <span class="n">client_cert</span><span class="o">.</span><span class="n">public_key</span><span class="p">())</span>
</pre></div>
</div>
<p>Đoạn code trên thực hiện việc thực hiện trao đổi khóa với certificate (public key) nhận từ client, và server private key.</p>
<p>Mình thấy rằng đề đã cung cấp cho mình hai file cert và key của guest đã được ký bởi CA. Do đó mình dùng <cite>guest-ecdhcert.pem</cite> làm <cite>client_cert</cite>, và đề cũng đã cho mình <cite>server-ecdhcert.pem</cite> nên mình có thể tính toán khóa trao đổi ở phía mình.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">server_secret</span> <span class="o">=</span> <span class="n">client_key</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="n">ec</span><span class="o">.</span><span class="n">ECDH</span><span class="p">(),</span> <span class="n">server_cert</span><span class="o">.</span><span class="n">public_key</span><span class="p">())</span>
</pre></div>
</div>
<p>Đoạn code sau đây sẽ thực hiện việc bắt tay trên TLS.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">r</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">&quot;mytls.2023.ctfcompetition.com&quot;</span><span class="p">,</span> <span class="mi">1337</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Please provide the client certificate in PEM format:&#39;</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;guest-ecdhcert.pem&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
        <span class="n">r</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">()</span>

<span class="c1"># Exchange ECDH</span>
<span class="n">r</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Please provide the ephemeral client random:&#39;</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
<span class="n">r</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Please provide the ephemeral client key:&#39;</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;client-ecdhcert.pem&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
        <span class="n">r</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">()</span>

<span class="c1"># Get server ephemeral public key</span>
<span class="n">r</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Server ephemeral random:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">server_random</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="n">r</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Server ephemeral key:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">server_cert</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">:</span> <span class="k">break</span>
    <span class="n">server_cert</span> <span class="o">+=</span> <span class="n">data</span>

<span class="n">server_cert</span> <span class="o">=</span> <span class="n">serialization</span><span class="o">.</span><span class="n">load_pem_public_key</span><span class="p">(</span><span class="n">server_cert</span><span class="p">)</span>

<span class="c1"># Load client epehmeral private key</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;client-ecdhkey.pem&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">client_ephemeral_private_key</span> <span class="o">=</span> <span class="n">serialization</span><span class="o">.</span><span class="n">load_pem_private_key</span><span class="p">(</span>
        <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">default_backend</span><span class="p">()</span>
    <span class="p">)</span>

<span class="c1"># Calculate shared key</span>
<span class="n">server_ephemeral_secret</span> <span class="o">=</span> <span class="n">client_ephemeral_private_key</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="n">ec</span><span class="o">.</span><span class="n">ECDH</span><span class="p">(),</span> <span class="n">server_cert</span><span class="p">)</span>

<span class="c1"># Exchange cert and key</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;server-ecdhcert.pem&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">server_public_key</span> <span class="o">=</span> <span class="n">x509</span><span class="o">.</span><span class="n">load_pem_x509_certificate</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
    <span class="n">server_public_key</span> <span class="o">=</span> <span class="n">server_public_key</span><span class="o">.</span><span class="n">public_key</span><span class="p">()</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;guest-ecdhkey.pem&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">client_key</span> <span class="o">=</span> <span class="n">serialization</span><span class="o">.</span><span class="n">load_pem_private_key</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="kc">None</span><span class="p">)</span>

<span class="n">server_secret</span> <span class="o">=</span> <span class="n">client_key</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="n">ec</span><span class="o">.</span><span class="n">ECDH</span><span class="p">(),</span> <span class="n">server_public_key</span><span class="p">)</span>

<span class="n">derived_key</span> <span class="o">=</span> <span class="n">HKDF</span><span class="p">(</span><span class="n">algorithm</span><span class="o">=</span><span class="n">hashes</span><span class="o">.</span><span class="n">SHA256</span><span class="p">(),</span>
                <span class="n">length</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>
                <span class="n">salt</span><span class="o">=</span><span class="sa">b</span><span class="s1">&#39;SaltyMcSaltFace&#39;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="sa">b</span><span class="s2">&quot;mytls&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">derive</span><span class="p">(</span>
                    <span class="n">server_ephemeral_secret</span> <span class="o">+</span>
                    <span class="n">server_secret</span> <span class="o">+</span>
                    <span class="nb">bytes</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span> <span class="o">+</span>
                    <span class="n">server_random</span>
                <span class="p">)</span>

<span class="n">client_hmac</span> <span class="o">=</span> <span class="n">hmac</span><span class="o">.</span><span class="n">HMAC</span><span class="p">(</span><span class="n">derived_key</span><span class="p">,</span> <span class="n">hashes</span><span class="o">.</span><span class="n">SHA256</span><span class="p">())</span>
<span class="n">client_hmac</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;client myTLS successful!&#39;</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Please provide the client HMAC:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">client_hmac</span><span class="o">.</span><span class="n">finalize</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>

<span class="n">server_hmac</span> <span class="o">=</span> <span class="n">hmac</span><span class="o">.</span><span class="n">HMAC</span><span class="p">(</span><span class="n">derived_key</span><span class="p">,</span> <span class="n">hashes</span><span class="o">.</span><span class="n">SHA256</span><span class="p">())</span>
<span class="n">server_hmac</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;server myTLS successful!&#39;</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Server HMAC:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">server_hmac</span><span class="o">.</span><span class="n">finalize</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span> <span class="o">==</span> <span class="n">r</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</pre></div>
</div>
<p>Tuy nhiên tới đây chúng ta vấp phải một vấn đề, đó là subject được ký trên certificate phải là <cite>admin.tls</cite>, trong khi nếu sử dụng <cite>guest-ecdhcert.pem</cite> thì subject là <cite>guest.tls</cite>. Hmm tình hình có vẻ khá phức tạp. Tới đây thì mình chịu chết, sau giải mới làm ra :D</p>
<p>Khi nhìn vào file Docker, mình thấy rằng file <cite>server-ecdhkey</cite>.pem cũng được chép vào container. Từ đó, ở mỗi lần chạy vòng lặp, mình sẽ chỉ định path của file thành <cite>../../app/server-ecdhkey.pem</cite> để thoát khỏi path <cite>/tmp/storage</cite>, vì khi đó mình sẽ &quot;đọc&quot; được một ít thông tin nào đó từ <cite>server-ecdhkey.pem</cite>.</p>
<p>Do <cite>server-ecdhcert.pem</cite> có <span class="math notranslate nohighlight">\(241\)</span> bytes, mình đoán rằng <cite>server-ecdhkey.pem</cite> cũng có <span class="math notranslate nohighlight">\(241\)</span> bytes. Do đó chiến thuật của mình là ghi đè lên <span class="math notranslate nohighlight">\(240\)</span> bytes đầu của <cite>server-ecdh.pem</cite>, server sẽ trả về hash <cite>H(240_bytes_ghi_đè || byte_cuối)</cite>. Mình có thể bruteforce byte cuối với <span class="math notranslate nohighlight">\(240\)</span> bytes ghi đè ban đầu fix sẵn.</p>
<p>Sau đó mình connect lại. Với byte cuối đã biết, mình sẽ bruteforce byte kế cuối với <span class="math notranslate nohighlight">\(239\)</span> bytes ghi đè. Lúc này server trả về hash <cite>H(239_bytes_ghi_đè || byte_kế_cuối || byte_cuối)</cite>.</p>
<p>Như vậy mình bruteforce từ dưới lên với công thức <cite>((240-số bytes đã biết) || byte_cần_brute || bytes_đã_biết)</cite> (có 241 bytes).</p>
<p>Full code để bruteforce <cite>server-ecdhkey.pem</cite>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># get_key.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pwn</span><span class="w"> </span><span class="kn">import</span> <span class="n">remote</span><span class="p">,</span> <span class="n">context</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cryptography.hazmat.primitives</span><span class="w"> </span><span class="kn">import</span> <span class="n">serialization</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cryptography.hazmat.backends</span><span class="w"> </span><span class="kn">import</span> <span class="n">default_backend</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cryptography.hazmat.primitives.asymmetric</span><span class="w"> </span><span class="kn">import</span> <span class="n">ec</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cryptography.hazmat.primitives.asymmetric</span><span class="w"> </span><span class="kn">import</span> <span class="n">rsa</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cryptography.hazmat.primitives.ciphers</span><span class="w"> </span><span class="kn">import</span> <span class="n">Cipher</span><span class="p">,</span> <span class="n">algorithms</span><span class="p">,</span> <span class="n">modes</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cryptography.hazmat.primitives.kdf.hkdf</span><span class="w"> </span><span class="kn">import</span> <span class="n">HKDF</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cryptography.hazmat.primitives</span><span class="w"> </span><span class="kn">import</span> <span class="n">hashes</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cryptography.hazmat.primitives</span><span class="w"> </span><span class="kn">import</span> <span class="n">hmac</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cryptography</span><span class="w"> </span><span class="kn">import</span> <span class="n">x509</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">binascii</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>

<span class="c1">#context.log_level = &#39;Debug&#39;</span>

<span class="k">def</span><span class="w"> </span><span class="nf">print_encrypted</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">iv</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="n">cipher</span> <span class="o">=</span> <span class="n">Cipher</span><span class="p">(</span>
        <span class="n">algorithms</span><span class="o">.</span><span class="n">AES</span><span class="p">(</span><span class="n">key</span><span class="p">),</span>
        <span class="n">modes</span><span class="o">.</span><span class="n">CBC</span><span class="p">(</span><span class="n">binascii</span><span class="o">.</span><span class="n">unhexlify</span><span class="p">(</span><span class="n">iv</span><span class="p">)))</span>
    <span class="n">encryptor</span> <span class="o">=</span> <span class="n">cipher</span><span class="o">.</span><span class="n">encryptor</span><span class="p">()</span>
    <span class="n">message</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="n">encryptor</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
        <span class="n">message</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">16</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> <span class="o">%</span> <span class="mi">16</span><span class="p">))</span> <span class="o">+</span> <span class="n">encryptor</span><span class="o">.</span><span class="n">finalize</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">print_decrypted</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">iv</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="n">cipher</span> <span class="o">=</span> <span class="n">Cipher</span><span class="p">(</span>
        <span class="n">algorithms</span><span class="o">.</span><span class="n">AES</span><span class="p">(</span><span class="n">key</span><span class="p">),</span>
        <span class="n">modes</span><span class="o">.</span><span class="n">CBC</span><span class="p">(</span><span class="n">binascii</span><span class="o">.</span><span class="n">unhexlify</span><span class="p">(</span><span class="n">iv</span><span class="p">)))</span>
    <span class="n">decryptor</span> <span class="o">=</span> <span class="n">cipher</span><span class="o">.</span><span class="n">decryptor</span><span class="p">()</span>
    <span class="n">message</span> <span class="o">=</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="n">decryptor</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">payload</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">input_encrypted</span><span class="p">(</span><span class="n">iv</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="n">cipher</span> <span class="o">=</span> <span class="n">Cipher</span><span class="p">(</span>
        <span class="n">algorithms</span><span class="o">.</span><span class="n">AES</span><span class="p">(</span><span class="n">key</span><span class="p">),</span>
        <span class="n">modes</span><span class="o">.</span><span class="n">CBC</span><span class="p">(</span><span class="n">binascii</span><span class="o">.</span><span class="n">unhexlify</span><span class="p">(</span><span class="n">iv</span><span class="p">)))</span>
    <span class="n">decryptor</span> <span class="o">=</span> <span class="n">cipher</span><span class="o">.</span><span class="n">decryptor</span><span class="p">()</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="nb">input</span><span class="p">()</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="n">binascii</span><span class="o">.</span><span class="n">unhexlify</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">decryptor</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">res</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">)</span>


<span class="n">key_path</span> <span class="o">=</span> <span class="s2">&quot;../../app/server-ecdhkey.pem&quot;</span>
<span class="n">known</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">&quot;mytls.2023.ctfcompetition.com&quot;</span><span class="p">,</span> <span class="mi">1337</span><span class="p">)</span>
    <span class="n">r</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Please provide the client certificate in PEM format:&#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;guest-ecdhcert.pem&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
            <span class="n">r</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">()</span>

    <span class="c1"># Exchange ECDH</span>
    <span class="n">r</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Please provide the ephemeral client random:&#39;</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
    <span class="n">r</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Please provide the ephemeral client key:&#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;client-ecdhcert.pem&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
            <span class="n">r</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
    <span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">()</span>

    <span class="c1"># Get server ephemeral public key</span>
    <span class="n">r</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Server ephemeral random:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">server_random</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">r</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Server ephemeral key:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">server_cert</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">:</span> <span class="k">break</span>
        <span class="n">server_cert</span> <span class="o">+=</span> <span class="n">data</span>

    <span class="n">server_cert</span> <span class="o">=</span> <span class="n">serialization</span><span class="o">.</span><span class="n">load_pem_public_key</span><span class="p">(</span><span class="n">server_cert</span><span class="p">)</span>

    <span class="c1"># Load client epehmeral private key</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;client-ecdhkey.pem&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">client_ephemeral_private_key</span> <span class="o">=</span> <span class="n">serialization</span><span class="o">.</span><span class="n">load_pem_private_key</span><span class="p">(</span>
            <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span>
            <span class="kc">None</span><span class="p">,</span>
            <span class="n">default_backend</span><span class="p">()</span>
        <span class="p">)</span>

    <span class="c1"># Calculate shared key</span>
    <span class="n">server_ephemeral_secret</span> <span class="o">=</span> <span class="n">client_ephemeral_private_key</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="n">ec</span><span class="o">.</span><span class="n">ECDH</span><span class="p">(),</span> <span class="n">server_cert</span><span class="p">)</span>

    <span class="c1"># Exchange cert and key</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;server-ecdhcert.pem&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">server_public_key</span> <span class="o">=</span> <span class="n">x509</span><span class="o">.</span><span class="n">load_pem_x509_certificate</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
        <span class="n">server_public_key</span> <span class="o">=</span> <span class="n">server_public_key</span><span class="o">.</span><span class="n">public_key</span><span class="p">()</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;guest-ecdhkey.pem&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">client_key</span> <span class="o">=</span> <span class="n">serialization</span><span class="o">.</span><span class="n">load_pem_private_key</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="kc">None</span><span class="p">)</span>

    <span class="n">server_secret</span> <span class="o">=</span> <span class="n">client_key</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="n">ec</span><span class="o">.</span><span class="n">ECDH</span><span class="p">(),</span> <span class="n">server_public_key</span><span class="p">)</span>

    <span class="n">derived_key</span> <span class="o">=</span> <span class="n">HKDF</span><span class="p">(</span><span class="n">algorithm</span><span class="o">=</span><span class="n">hashes</span><span class="o">.</span><span class="n">SHA256</span><span class="p">(),</span>
                    <span class="n">length</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>
                    <span class="n">salt</span><span class="o">=</span><span class="sa">b</span><span class="s1">&#39;SaltyMcSaltFace&#39;</span><span class="p">,</span>
                    <span class="n">info</span><span class="o">=</span><span class="sa">b</span><span class="s2">&quot;mytls&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">derive</span><span class="p">(</span>
                        <span class="n">server_ephemeral_secret</span> <span class="o">+</span>
                        <span class="n">server_secret</span> <span class="o">+</span>
                        <span class="nb">bytes</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span> <span class="o">+</span>
                        <span class="n">server_random</span>
                    <span class="p">)</span>

    <span class="n">client_hmac</span> <span class="o">=</span> <span class="n">hmac</span><span class="o">.</span><span class="n">HMAC</span><span class="p">(</span><span class="n">derived_key</span><span class="p">,</span> <span class="n">hashes</span><span class="o">.</span><span class="n">SHA256</span><span class="p">())</span>
    <span class="n">client_hmac</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;client myTLS successful!&#39;</span><span class="p">)</span>
    <span class="n">r</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Please provide the client HMAC:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">client_hmac</span><span class="o">.</span><span class="n">finalize</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>

    <span class="n">server_hmac</span> <span class="o">=</span> <span class="n">hmac</span><span class="o">.</span><span class="n">HMAC</span><span class="p">(</span><span class="n">derived_key</span><span class="p">,</span> <span class="n">hashes</span><span class="o">.</span><span class="n">SHA256</span><span class="p">())</span>
    <span class="n">server_hmac</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;server myTLS successful!&#39;</span><span class="p">)</span>
    <span class="n">r</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Server HMAC:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">server_hmac</span><span class="o">.</span><span class="n">finalize</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span> <span class="o">==</span> <span class="n">r</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>

    <span class="n">ciphertext</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span> <span class="c1"># now ignore</span>
    <span class="n">ctx</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
    <span class="n">print_decrypted</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">server_random</span><span class="p">,</span> <span class="n">derived_key</span><span class="p">)</span>
    <span class="n">storage_slot</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">print_encrypted</span><span class="p">(</span><span class="n">key_path</span><span class="p">,</span> <span class="n">server_random</span><span class="p">,</span> <span class="n">derived_key</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
    <span class="n">ctx</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
    <span class="n">print_decrypted</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">server_random</span><span class="p">,</span> <span class="n">derived_key</span><span class="p">)</span>

    <span class="n">overwrite_payload</span> <span class="o">=</span> <span class="s2">&quot;A&quot;</span><span class="o">*</span><span class="p">(</span><span class="mi">240</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">known</span><span class="p">))</span>
    <span class="n">secret</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">print_encrypted</span><span class="p">(</span><span class="n">overwrite_payload</span><span class="p">,</span> <span class="n">server_random</span><span class="p">,</span> <span class="n">derived_key</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
    <span class="n">prev_hash</span> <span class="o">=</span> <span class="n">print_decrypted</span><span class="p">(</span>
        <span class="n">r</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(),</span>
        <span class="n">server_random</span><span class="p">,</span>
        <span class="n">derived_key</span><span class="p">)</span>
    <span class="n">prev_hash</span> <span class="o">=</span> <span class="n">prev_hash</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Phase 2</span>
    <span class="n">ctx</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">print_decrypted</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">server_random</span><span class="p">,</span> <span class="n">derived_key</span><span class="p">))</span>
    <span class="n">storage_slot</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">print_encrypted</span><span class="p">(</span><span class="n">key_path</span><span class="p">,</span> <span class="n">server_random</span><span class="p">,</span> <span class="n">derived_key</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
    <span class="n">ctx</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">print_decrypted</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">server_random</span><span class="p">,</span> <span class="n">derived_key</span><span class="p">))</span>

    <span class="c1">#overwrite_payload = &quot;A&quot;*240</span>
    <span class="n">secret</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">print_encrypted</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="n">server_random</span><span class="p">,</span> <span class="n">derived_key</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
    <span class="n">prev_hash</span> <span class="o">=</span> <span class="n">print_decrypted</span><span class="p">(</span>
        <span class="n">r</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(),</span>
        <span class="n">server_random</span><span class="p">,</span>
        <span class="n">derived_key</span><span class="p">)</span>
    <span class="n">prev_hash</span> <span class="o">=</span> <span class="n">prev_hash</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;sha256&quot;</span><span class="p">)</span>
        <span class="n">h</span><span class="o">.</span><span class="n">update</span><span class="p">((</span><span class="n">overwrite_payload</span> <span class="o">+</span> <span class="nb">chr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">known</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">h</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span> <span class="o">==</span> <span class="n">prev_hash</span><span class="o">.</span><span class="n">decode</span><span class="p">():</span>
            <span class="n">known</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">known</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Found&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="k">break</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">known</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">known</span><span class="p">)</span> <span class="o">==</span> <span class="mi">241</span><span class="p">:</span>
        <span class="k">break</span>

<span class="n">r</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>Sau khi đã có <cite>server-ecdhkey.pem</cite>, mình quay lại bypass phần kiểm tra subject của certificate. Trong các file cert được cho thì có <cite>admin-ecdhcert.pem</cite> là có subject chúng ta cần (CN=admin.tls). Mình đã có <cite>server-ecdhcert.pem</cite> và <cite>server-ecdhkey.pem</cite> (vừa leak) để tiến hành trao đổi khóa. Tuy nhiên <cite>server-ecdhcert.pem</cite> thì lại không có CN=admin.tls.</p>
<p>Ở đây mình gửi lên <cite>admin-ecdhcert.pem</cite>, nhưng khi tính khóa trao đổi thì sử dụng <cite>server-ecdhkey.pem</cite> (không gửi <cite>server-ecdhcert.pem</cite>) và nó đã work!!! Đọc writeup của mọi người thì họ gọi là KCI attack do tính chất trao đổi khóa Diffie-Hellman.</p>
<p>Mình sửa đổi một tí file trên để lấy flag (gửi lên cert là <cite>admin-ecdhcert.pem</cite> và dùng <cite>server-ecdhkey</cite> để tính <cite>share_key</cite>).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># solve.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pwn</span><span class="w"> </span><span class="kn">import</span> <span class="n">remote</span><span class="p">,</span> <span class="n">context</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cryptography.hazmat.primitives</span><span class="w"> </span><span class="kn">import</span> <span class="n">serialization</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cryptography.hazmat.backends</span><span class="w"> </span><span class="kn">import</span> <span class="n">default_backend</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cryptography.hazmat.primitives.asymmetric</span><span class="w"> </span><span class="kn">import</span> <span class="n">ec</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cryptography.hazmat.primitives.asymmetric</span><span class="w"> </span><span class="kn">import</span> <span class="n">rsa</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cryptography.hazmat.primitives.ciphers</span><span class="w"> </span><span class="kn">import</span> <span class="n">Cipher</span><span class="p">,</span> <span class="n">algorithms</span><span class="p">,</span> <span class="n">modes</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cryptography.hazmat.primitives.kdf.hkdf</span><span class="w"> </span><span class="kn">import</span> <span class="n">HKDF</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cryptography.hazmat.primitives</span><span class="w"> </span><span class="kn">import</span> <span class="n">hashes</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cryptography.hazmat.primitives</span><span class="w"> </span><span class="kn">import</span> <span class="n">hmac</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cryptography</span><span class="w"> </span><span class="kn">import</span> <span class="n">x509</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">binascii</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>

<span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s1">&#39;Debug&#39;</span>

<span class="k">def</span><span class="w"> </span><span class="nf">print_encrypted</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">iv</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="n">cipher</span> <span class="o">=</span> <span class="n">Cipher</span><span class="p">(</span>
        <span class="n">algorithms</span><span class="o">.</span><span class="n">AES</span><span class="p">(</span><span class="n">key</span><span class="p">),</span>
        <span class="n">modes</span><span class="o">.</span><span class="n">CBC</span><span class="p">(</span><span class="n">binascii</span><span class="o">.</span><span class="n">unhexlify</span><span class="p">(</span><span class="n">iv</span><span class="p">)))</span>
    <span class="n">encryptor</span> <span class="o">=</span> <span class="n">cipher</span><span class="o">.</span><span class="n">encryptor</span><span class="p">()</span>
    <span class="n">message</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="n">encryptor</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
        <span class="n">message</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">16</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> <span class="o">%</span> <span class="mi">16</span><span class="p">))</span> <span class="o">+</span> <span class="n">encryptor</span><span class="o">.</span><span class="n">finalize</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">print_decrypted</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">iv</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="n">cipher</span> <span class="o">=</span> <span class="n">Cipher</span><span class="p">(</span>
        <span class="n">algorithms</span><span class="o">.</span><span class="n">AES</span><span class="p">(</span><span class="n">key</span><span class="p">),</span>
        <span class="n">modes</span><span class="o">.</span><span class="n">CBC</span><span class="p">(</span><span class="n">binascii</span><span class="o">.</span><span class="n">unhexlify</span><span class="p">(</span><span class="n">iv</span><span class="p">)))</span>
    <span class="n">decryptor</span> <span class="o">=</span> <span class="n">cipher</span><span class="o">.</span><span class="n">decryptor</span><span class="p">()</span>
    <span class="n">message</span> <span class="o">=</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="n">decryptor</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">payload</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">input_encrypted</span><span class="p">(</span><span class="n">iv</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="n">cipher</span> <span class="o">=</span> <span class="n">Cipher</span><span class="p">(</span>
        <span class="n">algorithms</span><span class="o">.</span><span class="n">AES</span><span class="p">(</span><span class="n">key</span><span class="p">),</span>
        <span class="n">modes</span><span class="o">.</span><span class="n">CBC</span><span class="p">(</span><span class="n">binascii</span><span class="o">.</span><span class="n">unhexlify</span><span class="p">(</span><span class="n">iv</span><span class="p">)))</span>
    <span class="n">decryptor</span> <span class="o">=</span> <span class="n">cipher</span><span class="o">.</span><span class="n">decryptor</span><span class="p">()</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="nb">input</span><span class="p">()</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="n">binascii</span><span class="o">.</span><span class="n">unhexlify</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">decryptor</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">res</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">)</span>


<span class="n">r</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">&quot;mytls.2023.ctfcompetition.com&quot;</span><span class="p">,</span> <span class="mi">1337</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Please provide the client certificate in PEM format:&#39;</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;admin-ecdhcert.pem&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
        <span class="n">r</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">()</span>

<span class="c1"># Exchange ECDH</span>
<span class="n">r</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Please provide the ephemeral client random:&#39;</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
<span class="n">r</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Please provide the ephemeral client key:&#39;</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;client-ecdhcert.pem&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
        <span class="n">r</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">()</span>

<span class="c1"># Get server ephemeral public key</span>
<span class="n">r</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Server ephemeral random:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">server_random</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="n">r</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Server ephemeral key:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">server_cert</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">:</span> <span class="k">break</span>
    <span class="n">server_cert</span> <span class="o">+=</span> <span class="n">data</span>

<span class="n">server_cert</span> <span class="o">=</span> <span class="n">serialization</span><span class="o">.</span><span class="n">load_pem_public_key</span><span class="p">(</span><span class="n">server_cert</span><span class="p">)</span>
<span class="c1"># Load client epehmeral private key</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;client-ecdhkey.pem&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">client_secret</span> <span class="o">=</span> <span class="n">serialization</span><span class="o">.</span><span class="n">load_pem_private_key</span><span class="p">(</span>
        <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">default_backend</span><span class="p">()</span>
    <span class="p">)</span>

<span class="c1"># Calculate shared key</span>
<span class="n">server_ephemeral_secret</span> <span class="o">=</span> <span class="n">client_secret</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="n">ec</span><span class="o">.</span><span class="n">ECDH</span><span class="p">(),</span> <span class="n">server_cert</span><span class="p">)</span>

<span class="c1"># Exchange cert and key</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;admin-ecdhcert.pem&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">server_public_key</span> <span class="o">=</span> <span class="n">x509</span><span class="o">.</span><span class="n">load_pem_x509_certificate</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
    <span class="n">server_public_key</span> <span class="o">=</span> <span class="n">server_public_key</span><span class="o">.</span><span class="n">public_key</span><span class="p">()</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;server-ecdhkey.pem&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">client_key</span> <span class="o">=</span> <span class="n">serialization</span><span class="o">.</span><span class="n">load_pem_private_key</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="kc">None</span><span class="p">)</span>
<span class="n">server_secret</span> <span class="o">=</span> <span class="n">client_key</span><span class="o">.</span><span class="n">exchange</span><span class="p">(</span><span class="n">ec</span><span class="o">.</span><span class="n">ECDH</span><span class="p">(),</span> <span class="n">server_public_key</span><span class="p">)</span>

<span class="n">derived_key</span> <span class="o">=</span> <span class="n">HKDF</span><span class="p">(</span><span class="n">algorithm</span><span class="o">=</span><span class="n">hashes</span><span class="o">.</span><span class="n">SHA256</span><span class="p">(),</span>
                <span class="n">length</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>
                <span class="n">salt</span><span class="o">=</span><span class="sa">b</span><span class="s1">&#39;SaltyMcSaltFace&#39;</span><span class="p">,</span>
                <span class="n">info</span><span class="o">=</span><span class="sa">b</span><span class="s2">&quot;mytls&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">derive</span><span class="p">(</span>
                    <span class="n">server_ephemeral_secret</span> <span class="o">+</span>
                    <span class="n">server_secret</span> <span class="o">+</span>
                    <span class="nb">bytes</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span> <span class="o">+</span>
                    <span class="n">server_random</span>
                <span class="p">)</span>

<span class="n">client_hmac</span> <span class="o">=</span> <span class="n">hmac</span><span class="o">.</span><span class="n">HMAC</span><span class="p">(</span><span class="n">derived_key</span><span class="p">,</span> <span class="n">hashes</span><span class="o">.</span><span class="n">SHA256</span><span class="p">())</span>
<span class="n">client_hmac</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;client myTLS successful!&#39;</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Please provide the client HMAC:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">client_hmac</span><span class="o">.</span><span class="n">finalize</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>

<span class="n">server_hmac</span> <span class="o">=</span> <span class="n">hmac</span><span class="o">.</span><span class="n">HMAC</span><span class="p">(</span><span class="n">derived_key</span><span class="p">,</span> <span class="n">hashes</span><span class="o">.</span><span class="n">SHA256</span><span class="p">())</span>
<span class="n">server_hmac</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;server myTLS successful!&#39;</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Server HMAC:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">server_hmac</span><span class="o">.</span><span class="n">finalize</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span> <span class="o">==</span> <span class="n">r</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>

<span class="n">ciphertext</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span> <span class="c1"># now ignore</span>
<span class="nb">print</span><span class="p">(</span><span class="n">print_decrypted</span><span class="p">(</span><span class="n">ciphertext</span><span class="p">,</span> <span class="n">server_random</span><span class="p">,</span> <span class="n">derived_key</span><span class="p">))</span>
<span class="n">r</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># b&#39;Hello admin! CTF{KeyC0mpromiseAll0w51mpersonation}\n&#39;</span>
</pre></div>
</div>
</section>
<section id="primes">
<h2>PRIMES<a class="headerlink" href="#primes" title="Link to this heading">¶</a></h2>
<p>Đề bài cho mình một dãy các số nguyên tố <span class="math notranslate nohighlight">\(p_i\)</span> cố định và một số nguyên tố <span class="math notranslate nohighlight">\(q\)</span>.</p>
<p>Giả sử plaintext được biểu diễn ở dạng chuỗi bit <span class="math notranslate nohighlight">\(b = (b_1, b_2, \ldots, b_n)\)</span> thì ciphertext sẽ là <span class="math notranslate nohighlight">\(x = \prod\limits_{i=1}^n p_i^{b_i} \bmod q\)</span>.</p>
<p>Tuy nhiên message <span class="math notranslate nohighlight">\(m\)</span> mà đề cho không encrypt ra <span class="math notranslate nohighlight">\(x\)</span> tương ứng, mình sẽ gọi là <span class="math notranslate nohighlight">\(y\)</span>. Nghĩa là nếu biểu diễn <span class="math notranslate nohighlight">\(m = (m_1, m_2, \ldots, m_n)\)</span> thì mình có <span class="math notranslate nohighlight">\(y = \prod\limits_{i=1}^n p_i^{m_i} \bmod q\)</span>. Ở đây <span class="math notranslate nohighlight">\(m\)</span> và flag có cùng độ dài và sự sai lệch bit không đáng kể.</p>
<p>Hmm, sai lệch bit không đáng kể? :v</p>
<p>Đặt</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[e = x y^{-1} = \prod_{i=1}^n p_i^{b_i - m_i} = \prod_{i=1}^n p_i^{e_i} \bmod q.\]</div>
</div>
<p>Khi đó <span class="math notranslate nohighlight">\(e_i \in \{-1, 0, 1\}\)</span>.</p>
<p>Suy ra <span class="math notranslate nohighlight">\(e = nd^{-1} \bmod q\)</span> với <span class="math notranslate nohighlight">\(n\)</span> và <span class="math notranslate nohighlight">\(d\)</span> phân tích được thành lũy thừa dương của các <span class="math notranslate nohighlight">\(p_i\)</span>, từ đó tồn tại <span class="math notranslate nohighlight">\(s \in \mathbb{Z}\)</span> để <span class="math notranslate nohighlight">\(ed = n + sq\)</span>.</p>
<p>Do <span class="math notranslate nohighlight">\(\lvert ed - sq \rvert = n\)</span> nên tương đương với <span class="math notranslate nohighlight">\(\Bigg\lvert \dfrac{ed}{qd} - \dfrac{sq}{qd} \Bigg\rvert = \dfrac{n}{qd}\)</span>, hay <span class="math notranslate nohighlight">\(\Bigg\lvert \dfrac{e}{q} - \dfrac{s}{d} \Bigg\rvert = \dfrac{n}{qd}\)</span>.</p>
<p>Bài này dựa trên ý tưởng <a class="reference external" href="https://en.wikipedia.org/wiki/Diophantine_approximation">xấp xỉ Diophantine</a>. Ở đây điều kiện để tồn tại chuỗi liên phân số hội tụ là <span class="math notranslate nohighlight">\(nd &lt; \dfrac{q}{2}\)</span>. Khi đó <span class="math notranslate nohighlight">\(\dfrac{s}{d}\)</span> là liên phân số hội tụ dần tới <span class="math notranslate nohighlight">\(\dfrac{1}{d^2}\)</span> do <span class="math notranslate nohighlight">\(\dfrac{n}{qd} &lt; \dfrac{1}{d^2}\)</span>.</p>
<p>Sử dụng SageMath mình có thể tìm được dãy các phân số <span class="math notranslate nohighlight">\(\dfrac{s_j}{d_j}\)</span> hội tụ tới <span class="math notranslate nohighlight">\(\dfrac{1}{d^2}\)</span>. Do đó chiến thuật để giải bài này là tìm <span class="math notranslate nohighlight">\(d_j\)</span> mà có thể phân tích thành lũy thừa không âm của các <span class="math notranslate nohighlight">\(p_i\)</span> (tương ứng <span class="math notranslate nohighlight">\(y\)</span>). Sau đó với <span class="math notranslate nohighlight">\(d_j e\)</span> mà cũng có thể phân tích thành lũy thừa không âm của các <span class="math notranslate nohighlight">\(p_i\)</span> (tương ứng với <span class="math notranslate nohighlight">\(x\)</span>) thì ta sẽ tìm được phân tích tốt nhất để sửa các bit error <span class="math notranslate nohighlight">\(e_i\)</span>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">to_bits</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
    <span class="n">_bin</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">b</span> <span class="p">:</span> <span class="p">[</span><span class="mi">1</span> <span class="k">if</span> <span class="n">b</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">n</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">)]</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">_bin</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">m</span><span class="p">],</span> <span class="p">[])</span>

<span class="k">def</span><span class="w"> </span><span class="nf">from_bits</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
    <span class="n">_byte</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">c</span> <span class="p">:</span> <span class="nb">bytes</span><span class="p">([</span><span class="nb">sum</span><span class="p">([</span><span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">)])])</span>
    <span class="k">return</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">_byte</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">7</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="mi">7</span><span class="p">)])</span>

<span class="k">def</span><span class="w"> </span><span class="nf">gen_primes</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="n">primes</span> <span class="o">=</span> <span class="n">Primes</span><span class="p">()[:</span><span class="n">n</span><span class="p">]</span>
    <span class="n">bound</span> <span class="o">=</span> <span class="n">prod</span><span class="p">(</span><span class="n">primes</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="n">r</span><span class="p">:])</span>
    <span class="k">return</span> <span class="n">primes</span><span class="p">,</span> <span class="n">next_prime</span><span class="p">(</span><span class="n">bound</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">bitxor</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^^</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">))]</span>

<span class="k">def</span><span class="w"> </span><span class="nf">prod_exp</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">prod</span><span class="p">([</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">^</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">))])</span> <span class="o">%</span> <span class="n">q</span>

<span class="k">def</span><span class="w"> </span><span class="nf">encode</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
    <span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="n">gen_primes</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">prod_exp</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">to_bits</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>

<span class="k">def</span><span class="w"> </span><span class="nf">cfactor</span><span class="p">(</span><span class="n">primes</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="k">return</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">primes</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">%</span> <span class="n">p</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">//=</span> <span class="n">p</span>
    <span class="k">return</span> <span class="n">res</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="kc">None</span>

<span class="n">m</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;I have a sweet flag for you: CTF</span><span class="si">{YkDOLIStjpjP5Am1SXDt5d2r9es3b5KZP47v8rXF}</span><span class="s2">&quot;</span>
<span class="c1">#p, q, x = encode(131, 7*len(m), m)</span>

<span class="n">q</span> <span class="o">=</span> <span class="mh">0xD2F8711CB5502C512ACEA59BE181A8FCF12F183B540D9A6998BF66370F9538F7E39FC507545DAD9AA2E71D3313F0B4408695A0A2C03A790662A9BD01650533C584C90779B73604FB8157F0AB7C9A82E724700E5937D9FF5FCF1EE3BE1EDD7E07B4C0F035A58CC2B9DB8B79F176F595C1B0E90B7957309B96106A50A01B78171599B41C8744BCB1C0E6A24F60AE8946D37F4D4BD8CF286A336E1022996B3BA3918E4D808627D0315BFE291AEB884CBE98BB620DAA735B0467F3287D158231D</span>
<span class="n">X</span> <span class="o">=</span> <span class="mh">0x947062E712C031ADD0B60416D3B87D54B50C1EFBC8DBB87346F960B242AF3DF6DD47406FEC98053A967D28FE91B130FF0FE93689122931F0BA6E73A3E9E6C873B8E2344A459244D1295E99A241E59E1EEA796E9738E6B1EDEED3D91AE6747E8ECA634C030B90B02BAF8AE0088058F6994C7CAC232835AC72D8B23A96F10EF03D74F82C49D4513423DAC298698094B5C631B9C7C62850C498330E9D112BB9CAA574AEE6B0E5E66D5B234B23C755AC1719B4B68133E680A7BCF48B4CFD0924D</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">Primes</span><span class="p">()[:</span><span class="mi">7</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">)]</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">to_bits</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">prod_exp</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<span class="n">E</span> <span class="o">=</span> <span class="n">X</span> <span class="o">*</span> <span class="nb">pow</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span> <span class="o">%</span> <span class="n">q</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">continued_fraction</span><span class="p">(</span><span class="n">E</span><span class="o">/</span><span class="n">q</span><span class="p">)</span>
<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">C</span><span class="o">.</span><span class="n">convergents</span><span class="p">():</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span> <span class="c1"># D</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">k</span><span class="o">*</span><span class="n">E</span> <span class="o">%</span> <span class="n">q</span>
    <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">l</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">F</span> <span class="o">=</span> <span class="n">cfactor</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
        <span class="n">Fp</span> <span class="o">=</span> <span class="n">cfactor</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">F</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">Fp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">F</span><span class="o">+</span><span class="n">Fp</span><span class="p">:</span>
                    <span class="n">mask</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">bitxor</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">from_bits</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</pre></div>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="diceCTF.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Dice CTF 2023</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="backdoorCTF.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Backdoor CTF 2023</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, Lê Quốc Dũng
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Google CTF 2023</a><ul>
<li><a class="reference internal" href="#least-common-genominator">LEAST COMMON GENOMINATOR?</a></li>
<li><a class="reference internal" href="#cursved">Cursved</a></li>
<li><a class="reference internal" href="#mhk2">MHK2</a><ul>
<li><a class="reference internal" href="#tao-private-key">1. Tạo private key</a></li>
<li><a class="reference internal" href="#tao-public-key">2. Tạo public key</a></li>
<li><a class="reference internal" href="#ma-hoa">3. Mã hóa</a></li>
<li><a class="reference internal" href="#khoi-phuc-private-key">4. Khôi phục private key</a><ul>
<li><a class="reference internal" href="#a-khoi-phuc-modulo">a. Khôi phục modulo</a></li>
<li><a class="reference internal" href="#b-khoi-phuc-e">b. Khôi phục e</a></li>
<li><a class="reference internal" href="#c-giai">c. Giải</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#mytls">MYTLS</a></li>
<li><a class="reference internal" href="#primes">PRIMES</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=dd9e4a14"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../_static/scripts/sphinx-book-theme.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script src="../_static/translations.js?v=4c1d55b0"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>window.MathJax = {"tex": {"macros": {"bm": ["{\\boldsymbol{#1}}", 1]}}, "chtml": {"mtextInheritFont": "true"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>